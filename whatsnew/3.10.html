<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Python 3.10 有什麼新功能 &#8212; Python 3.12.4 說明文件</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?v=41b4f12d" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css?v=b20cc3f5" />
    
    <script src="../_static/documentation_options.js?v=6bff4b4f"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=f1e884e3"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 3.12.4 說明文件 中搜尋"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="關於這些文件" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜尋" href="../search.html" />
    <link rel="copyright" title="版權" href="../copyright.html" />
    <link rel="next" title="Python 3.9 有什麼新功能" href="3.9.html" />
    <link rel="prev" title="Python 3.11 有什麼新功能" href="3.11.html" />
    
    <link rel="canonical" href="https://docs.python.org/3/whatsnew/3.10.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="stylesheet" href="../_static/pydoctheme_dark.css" media="(prefers-color-scheme: dark)" id="pydoctheme_dark_css">
    <link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script>
            <script type="text/javascript" src="../_static/search-focus.js"></script>
            <script type="text/javascript" src="../_static/themetoggle.js"></script> 
            <script type="text/javascript" src="../_static/rtd_switcher.js"></script>
            <meta name="readthedocs-addons-api-version" content="1">

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <nav class="nav-content" role="navigation">
        <label for="menuToggler" class="toggler__label">
            <span></span>
        </label>
        <span class="nav-items-wrapper">
            <a href="https://www.python.org/" class="nav-logo">
                <img src="../_static/py.svg" alt="Python logo"/>
            </a>
            <span class="version_switcher_placeholder"></span>
            <form role="search" class="search" action="../search.html" method="get">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                    <path fill-rule="nonzero" fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
                <input placeholder="快速搜尋" aria-label="快速搜尋" type="search" name="q" />
                <input type="submit" value="前往"/>
            </form>
        </span>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
            
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label>
  <div>
    <h3><a href="../contents.html">目錄</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.10 有什麼新功能</a><ul>
<li><a class="reference internal" href="#summary-release-highlights">摘要 -- 發布重點</a></li>
<li><a class="reference internal" href="#new-features">新功能</a><ul>
<li><a class="reference internal" href="#parenthesized-context-managers">帶括號的情境管理器</a></li>
<li><a class="reference internal" href="#better-error-messages">更好的錯誤訊息</a><ul>
<li><a class="reference internal" href="#syntaxerrors">SyntaxErrors</a></li>
<li><a class="reference internal" href="#indentationerrors">IndentationErrors</a></li>
<li><a class="reference internal" href="#attributeerrors">AttributeErrors</a></li>
<li><a class="reference internal" href="#nameerrors">NameErrors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pep-626-precise-line-numbers-for-debugging-and-other-tools">PEP 626：用於除錯和其他工具的精確列號</a></li>
<li><a class="reference internal" href="#pep-634-structural-pattern-matching">PEP 634：結構模式匹配</a><ul>
<li><a class="reference internal" href="#syntax-and-operations">語法和操作</a></li>
<li><a class="reference internal" href="#declarative-approach">宣告式方法 (Declarative approach)</a></li>
<li><a class="reference internal" href="#simple-pattern-match-to-a-literal">簡單模式：與字面值匹配</a><ul>
<li><a class="reference internal" href="#behavior-without-the-wildcard">沒有萬用字元 (wildcard) 的行為</a></li>
</ul>
</li>
<li><a class="reference internal" href="#patterns-with-a-literal-and-variable">具有字面值和變數的模式</a></li>
<li><a class="reference internal" href="#patterns-and-classes">模式和類別</a><ul>
<li><a class="reference internal" href="#patterns-with-positional-parameters">具有位置參數的模式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nested-patterns">巢狀模式</a></li>
<li><a class="reference internal" href="#complex-patterns-and-the-wildcard">複雜模式和萬用字元</a></li>
<li><a class="reference internal" href="#guard">Guard</a></li>
<li><a class="reference internal" href="#other-key-features">其他主要功能</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-encodingwarning-and-encoding-locale-option">可選的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code> 和 <code class="docutils literal notranslate"><span class="pre">encoding=&quot;locale&quot;</span></code> 選項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-features-related-to-type-hints">與型別提示相關的新功能</a><ul>
<li><a class="reference internal" href="#pep-604-new-type-union-operator">PEP 604：新型聯集運算子</a></li>
<li><a class="reference internal" href="#pep-612-parameter-specification-variables">PEP 612：參數規範變數</a></li>
<li><a class="reference internal" href="#pep-613-typealias">PEP 613：型別別名 (TypeAlias)</a></li>
<li><a class="reference internal" href="#pep-647-user-defined-type-guards">PEP 647：使用者定義的型別防護</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-language-changes">其他語言更動</a></li>
<li><a class="reference internal" href="#new-modules">新模組</a></li>
<li><a class="reference internal" href="#improved-modules">改進的模組</a><ul>
<li><a class="reference internal" href="#asyncio">asyncio</a></li>
<li><a class="reference internal" href="#argparse">argparse</a></li>
<li><a class="reference internal" href="#array">array</a></li>
<li><a class="reference internal" href="#asynchat-asyncore-smtpd">asynchat, asyncore, smtpd</a></li>
<li><a class="reference internal" href="#base64">base64</a></li>
<li><a class="reference internal" href="#bdb">bdb</a></li>
<li><a class="reference internal" href="#bisect">bisect</a></li>
<li><a class="reference internal" href="#codecs">codecs</a></li>
<li><a class="reference internal" href="#collections-abc">collections.abc</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#curses">curses</a></li>
<li><a class="reference internal" href="#dataclasses">dataclasses</a><ul>
<li><a class="reference internal" href="#slots">__slots__</a></li>
<li><a class="reference internal" href="#keyword-only-fields">僅限關鍵字欄位 (Keyword-only fields)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#distutils">distutils</a></li>
<li><a class="reference internal" href="#doctest">doctest</a></li>
<li><a class="reference internal" href="#encodings">encodings</a></li>
<li><a class="reference internal" href="#enum">enum</a></li>
<li><a class="reference internal" href="#fileinput">fileinput</a></li>
<li><a class="reference internal" href="#faulthandler">faulthandler</a></li>
<li><a class="reference internal" href="#gc">gc</a></li>
<li><a class="reference internal" href="#glob">glob</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#hmac">hmac</a></li>
<li><a class="reference internal" href="#idle-and-idlelib">IDLE 和 idlelib</a></li>
<li><a class="reference internal" href="#importlib-metadata">importlib.metadata</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#linecache">linecache</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#os-path">os.path</a></li>
<li><a class="reference internal" href="#pathlib">pathlib</a></li>
<li><a class="reference internal" href="#platform">platform</a></li>
<li><a class="reference internal" href="#pprint">pprint</a></li>
<li><a class="reference internal" href="#py-compile">py_compile</a></li>
<li><a class="reference internal" href="#pyclbr">pyclbr</a></li>
<li><a class="reference internal" href="#shelve">shelve</a></li>
<li><a class="reference internal" href="#statistics">statistics</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#sys">sys</a></li>
<li><a class="reference internal" href="#thread">_thread</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#traceback">traceback</a></li>
<li><a class="reference internal" href="#types">types</a></li>
<li><a class="reference internal" href="#typing">typing</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#xml">xml</a></li>
<li><a class="reference internal" href="#zipimport">zipimport</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimizations">最佳化</a></li>
<li><a class="reference internal" href="#deprecated">已棄用</a></li>
<li><a class="reference internal" href="#removed">已刪除</a></li>
<li><a class="reference internal" href="#porting-to-python-3-10">移植到 Python 3.10</a><ul>
<li><a class="reference internal" href="#changes-in-the-python-syntax">Python 語法的變化</a></li>
<li><a class="reference internal" href="#changes-in-the-python-api">Python API 的變化</a></li>
<li><a class="reference internal" href="#changes-in-the-c-api">C API 中的改動</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cpython-bytecode-changes">CPython 位元組碼更改</a></li>
<li><a class="reference internal" href="#build-changes">建置變更</a></li>
<li><a class="reference internal" href="#c-api-changes">C API 變更</a><ul>
<li><a class="reference internal" href="#pep-652-maintaining-the-stable-abi">PEP 652：維護穩定 ABI</a></li>
<li><a class="reference internal" href="#id1">新功能</a></li>
<li><a class="reference internal" href="#id2">移植到 Python 3.10</a></li>
<li><a class="reference internal" href="#id3">已棄用</a></li>
<li><a class="reference internal" href="#id4">已刪除</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notable-security-feature-in-3-10-7">Notable security feature in 3.10.7</a></li>
<li><a class="reference internal" href="#notable-security-feature-in-3-10-8">Notable security feature in 3.10.8</a></li>
<li><a class="reference internal" href="#notable-changes-in-3-10-12">Notable changes in 3.10.12</a><ul>
<li><a class="reference internal" href="#tarfile">tarfile</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上個主題</h4>
    <p class="topless"><a href="3.11.html"
                          title="上一章">Python 3.11 有什麼新功能</a></p>
  </div>
  <div>
    <h4>下個主題</h4>
    <p class="topless"><a href="3.9.html"
                          title="下一章">Python 3.9 有什麼新功能</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>此頁面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">回報錯誤</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.10.rst"
            rel="nofollow">顯示原始碼
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="Related">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="總索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模組索引"
             >模組</a> |</li>
        <li class="right" >
          <a href="3.9.html" title="Python 3.9 有什麼新功能"
             accesskey="N">下一頁</a> |</li>
        <li class="right" >
          <a href="3.11.html" title="Python 3.11 有什麼新功能"
             accesskey="P">上一頁</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.12.4 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Python 有什麼新功能？</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.10 有什麼新功能</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜尋" aria-label="快速搜尋" type="search" name="q" id="search-box" />
          <input type="submit" value="前往" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-10">
<h1>Python 3.10 有什麼新功能<a class="headerlink" href="#what-s-new-in-python-3-10" title="連結到這個標頭">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">編輯者<span class="colon">:</span></dt>
<dd class="field-odd"><p>Pablo Galindo Salgado</p>
</dd>
</dl>
<p>本文介紹了 Python 3.10 與 3.9 相比的新功能。Python 3.10 於 2021 年 10 月 4 日發布。有關完整詳細資訊，請參閱 <a class="reference internal" href="changelog.html#changelog"><span class="std std-ref">changelog</span></a>。</p>
<section id="summary-release-highlights">
<h2>摘要 -- 發布重點<a class="headerlink" href="#summary-release-highlights" title="連結到這個標頭">¶</a></h2>
<p>新增語法特性：</p>
<ul class="simple">
<li><p><span class="target" id="index-80"></span><a class="pep reference external" href="https://peps.python.org/pep-0634/"><strong>PEP 634</strong></a>，結構模式匹配 (Structural Pattern Matching)：規範</p></li>
<li><p><span class="target" id="index-81"></span><a class="pep reference external" href="https://peps.python.org/pep-0635/"><strong>PEP 635</strong></a>，結構模式匹配：動機和基本原理</p></li>
<li><p><span class="target" id="index-82"></span><a class="pep reference external" href="https://peps.python.org/pep-0636/"><strong>PEP 636</strong></a>，結構模式匹配：教學</p></li>
<li><p><a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=12782">bpo-12782</a>，現在正式允許帶括號的情境管理器 (context manager)。</p></li>
</ul>
<p>標準函式庫中的新功能：</p>
<ul class="simple">
<li><p><span class="target" id="index-83"></span><a class="pep reference external" href="https://peps.python.org/pep-0618/"><strong>PEP 618</strong></a>，新增可選的長度檢查到 zip。</p></li>
</ul>
<p>直譯器改進：</p>
<ul class="simple">
<li><p><span class="target" id="index-84"></span><a class="pep reference external" href="https://peps.python.org/pep-0626/"><strong>PEP 626</strong></a>，用於除錯和其他工具的精確列號。</p></li>
</ul>
<p>新的 typing 功能：</p>
<ul class="simple">
<li><p><span class="target" id="index-85"></span><a class="pep reference external" href="https://peps.python.org/pep-0604/"><strong>PEP 604</strong></a>，允許將聯集型別 (union types) 寫為 X | Y</p></li>
<li><p><span class="target" id="index-86"></span><a class="pep reference external" href="https://peps.python.org/pep-0612/"><strong>PEP 612</strong></a>，參數規範變數 (Parameter Specification Variables)</p></li>
<li><p><span class="target" id="index-87"></span><a class="pep reference external" href="https://peps.python.org/pep-0613/"><strong>PEP 613</strong></a>，顯式型別別名 (Explicit Type Aliases)</p></li>
<li><p><span class="target" id="index-88"></span><a class="pep reference external" href="https://peps.python.org/pep-0647/"><strong>PEP 647</strong></a>，使用者定義的型別防護 (User-Defined Type Guards)</p></li>
</ul>
<p>重要的棄用、刪除或限制：</p>
<ul class="simple">
<li><p><span class="target" id="index-89"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a>，需要 OpenSSL 1.1.1 或更高版本</p></li>
<li><p><span class="target" id="index-90"></span><a class="pep reference external" href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a>，棄用 distutils 模組。</p></li>
<li><p><span class="target" id="index-91"></span><a class="pep reference external" href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a>，棄用並準備刪除 PyUnicodeObject 中的 wstr 成員。</p></li>
<li><p><span class="target" id="index-92"></span><a class="pep reference external" href="https://peps.python.org/pep-0624/"><strong>PEP 624</strong></a>，刪除 Py_UNICODE 編碼器 API</p></li>
<li><p><span class="target" id="index-93"></span><a class="pep reference external" href="https://peps.python.org/pep-0597/"><strong>PEP 597</strong></a>，新增可選的 EncodingWarning</p></li>
</ul>
</section>
<section id="new-features">
<h2>新功能<a class="headerlink" href="#new-features" title="連結到這個標頭">¶</a></h2>
<section id="parenthesized-context-managers">
<span id="whatsnew310-pep563"></span><h3>帶括號的情境管理器<a class="headerlink" href="#parenthesized-context-managers" title="連結到這個標頭">¶</a></h3>
<p>現在支援使用成對的括號來將多個情境管理器以數行表示。這允許了與過去的引入陳述式 (import statement) 類似的方法來格式化一組多行的情境管理器集合。例如，以下範例現在都是有效的：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="p">(</span><span class="n">CtxManager</span><span class="p">()</span> <span class="k">as</span> <span class="n">example</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span>
    <span class="n">CtxManager1</span><span class="p">(),</span>
    <span class="n">CtxManager2</span><span class="p">()</span>
<span class="p">):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span><span class="n">CtxManager1</span><span class="p">()</span> <span class="k">as</span> <span class="n">example</span><span class="p">,</span>
      <span class="n">CtxManager2</span><span class="p">()):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span><span class="n">CtxManager1</span><span class="p">(),</span>
      <span class="n">CtxManager2</span><span class="p">()</span> <span class="k">as</span> <span class="n">example</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span>
    <span class="n">CtxManager1</span><span class="p">()</span> <span class="k">as</span> <span class="n">example1</span><span class="p">,</span>
    <span class="n">CtxManager2</span><span class="p">()</span> <span class="k">as</span> <span class="n">example2</span>
<span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>也可以在封閉群組的末尾使用逗號：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="p">(</span>
    <span class="n">CtxManager1</span><span class="p">()</span> <span class="k">as</span> <span class="n">example1</span><span class="p">,</span>
    <span class="n">CtxManager2</span><span class="p">()</span> <span class="k">as</span> <span class="n">example2</span><span class="p">,</span>
    <span class="n">CtxManager3</span><span class="p">()</span> <span class="k">as</span> <span class="n">example3</span><span class="p">,</span>
<span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>此新語法使用新剖析器的非 LL(1) 功能。檢查 <span class="target" id="index-94"></span><a class="pep reference external" href="https://peps.python.org/pep-0617/"><strong>PEP 617</strong></a> 了解更多詳細資訊。</p>
<p>（由 Guido van Rossum、Pablo Galindo 和 Lysandros Nikolaou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=12782">bpo-12782</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40334">bpo-40334</a> 中貢獻。）</p>
</section>
<section id="better-error-messages">
<h3>更好的錯誤訊息<a class="headerlink" href="#better-error-messages" title="連結到這個標頭">¶</a></h3>
<section id="syntaxerrors">
<h4>SyntaxErrors<a class="headerlink" href="#syntaxerrors" title="連結到這個標頭">¶</a></h4>
<p>當剖析包含未成對括號或方括號的程式碼時，直譯器現在會包含未成對括號的位置，而不是顯示 <em>SyntaxError: unexpected EOF while parsing</em> 或指向某些不正確的位置。例如，以下程式碼（注意未閉合的 <code class="docutils literal notranslate"><span class="pre">{</span></code> ）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">27</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">29</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">37</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="mi">38</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">39</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">45</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">46</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">47</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">48</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">49</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">54</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="n">some_other_code</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
</pre></div>
</div>
<p>以前版本的直譯器會在奇怪的地方顯示有語法錯誤：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;example.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span>
    <span class="n">some_other_code</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
                    <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
</pre></div>
</div>
<p>但在 Python 3.10 中，會發出一個資訊更豐富的錯誤：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;example.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">27</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">29</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">37</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
               <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="s1">&#39;{&#39;</span> <span class="n">was</span> <span class="n">never</span> <span class="n">closed</span>
</pre></div>
</div>
<p>同樣地，涉及未成對字串字面值（單引號和三引號）的錯誤現在會指向字串的開頭，而不是報告 EOF/EOL。</p>
<p>這些改進是受到 PyPy 直譯器的啟發。</p>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42864">bpo-42864</a> 和 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40176">bpo-40176</a> 中貢獻。）</p>
<p>直譯器引發的 <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 例外現在會突顯 (highlight) 構成語法錯誤之運算式的完整錯誤範圍，而不僅是檢測到問題的位置。如此一來，過去（像 Python 3.10 之前）的：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="w">           </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">Generator expression must be parenthesized</span>
</pre></div>
</div>
<p>現在 Python 3.10 則會將例外顯示為：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^^^</span>
<span class="gr">SyntaxError</span>: <span class="n">Generator expression must be parenthesized</span>
</pre></div>
</div>
<p>此改進由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43914">bpo-43914</a> 中貢獻。</p>
<p>已合併了大量針對 <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 例外的新專用訊息。一些最值得注意的如下：</p>
<ul>
<li><p>在區塊之前缺少 <code class="docutils literal notranslate"><span class="pre">:</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="n">event_horizon</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="n">event_horizon</span>
<span class="w">                                      </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">expected &#39;:&#39;</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42997">bpo-42997</a> 中貢獻。）</p>
</li>
<li><p>綜合運算目標中未加括號的元組：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="s1">&#39;1234&#39;</span><span class="p">)}</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="s1">&#39;1234&#39;</span><span class="p">)}</span>
<span class="w">     </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">did you forget parentheses around the comprehension target?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43017">bpo-43017</a> 中貢獻。）</p>
</li>
<li><p>容器字面值 (collection literals) 中和運算式之間缺少逗號：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span><span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span><span class="n">y</span><span class="p">:</span> <span class="mi">2</span>
<span class="gp">... </span><span class="n">z</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
<span class="w">    </span><span class="n">y</span><span class="p">:</span> <span class="mi">2</span>
<span class="w">       </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">invalid syntax. Perhaps you forgot a comma?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43822">bpo-43822</a> 中貢獻。）</p>
</li>
<li><p>不帶括號的多個例外型別：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">build_dyson_sphere</span><span class="p">()</span>
<span class="gp">... </span><span class="k">except</span> <span class="n">NotEnoughScienceError</span><span class="p">,</span> <span class="n">NotEnoughResourcesError</span><span class="p">:</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
<span class="w">    </span><span class="k">except</span> <span class="n">NotEnoughScienceError</span><span class="p">,</span> <span class="n">NotEnoughResourcesError</span><span class="p">:</span>
<span class="w">           </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">multiple exception types must be parenthesized</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43149">bpo-43149</a> 中貢獻。）</p>
</li>
<li><p>字典字面值中缺少 <code class="docutils literal notranslate"><span class="pre">:</span></code> 和值：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span><span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span><span class="n">y</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span><span class="n">z</span><span class="p">:</span>
<span class="gp">... </span><span class="p">}</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">4</span>
<span class="w">    </span><span class="n">z</span><span class="p">:</span>
<span class="w">     </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">expression expected after dictionary key and &#39;:&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span> <span class="n">w</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span> <span class="n">w</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="w">                        </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">&#39;:&#39; expected after dictionary key</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43823">bpo-43823</a> 中貢獻。）</p>
</li>
<li><p>沒有 <code class="docutils literal notranslate"><span class="pre">except</span></code> 或 <code class="docutils literal notranslate"><span class="pre">finally</span></code> 區塊的 <code class="docutils literal notranslate"><span class="pre">try</span></code> 區塊：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span><span class="n">something</span> <span class="o">=</span> <span class="mi">3</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
<span class="w">    </span><span class="n">something</span>  <span class="o">=</span> <span class="mi">3</span>
<span class="w">    </span><span class="pm">^^^^^^^^^</span>
<span class="gr">SyntaxError</span>: <span class="n">expected &#39;except&#39; or &#39;finally&#39; block</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44305">bpo-44305</a> 中貢獻。）</p>
</li>
<li><p>於比較中使用 <code class="docutils literal notranslate"><span class="pre">=</span></code> 而非 <code class="docutils literal notranslate"><span class="pre">==</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">event_horizon</span><span class="p">:</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">event_horizon</span><span class="p">:</span>
<span class="w">                       </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">cannot assign to attribute here. Maybe you meant &#39;==&#39; instead of &#39;=&#39;?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43797">bpo-43797</a> 中貢獻。）</p>
</li>
<li><p>f 字串中使用 <code class="docutils literal notranslate"><span class="pre">*</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s2">&quot;Black holes </span><span class="si">{</span><span class="o">*</span><span class="n">all_black_holes</span><span class="si">}</span><span class="s2"> and revelations&quot;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="n">all_black_holes</span><span class="p">)</span>
<span class="w">     </span><span class="pm">^</span>
<span class="gr">SyntaxError</span>: <span class="n">f-string: cannot use starred expression here</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41064">bpo-41064</a> 中貢獻。）</p>
</li>
</ul>
</section>
<section id="indentationerrors">
<h4>IndentationErrors<a class="headerlink" href="#indentationerrors" title="連結到這個標頭">¶</a></h4>
<p>許多 <a class="reference internal" href="../library/exceptions.html#IndentationError" title="IndentationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">IndentationError</span></code></a> 例外現在支援更多關於哪種區塊需要縮進的情境，包括陳述式的位置：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="gp">... </span>   <span class="k">if</span> <span class="n">lel</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
<span class="w">    </span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="w">    </span><span class="pm">^</span>
<span class="gr">IndentationError</span>: <span class="n">expected an indented block after &#39;if&#39; statement in line 2</span>
</pre></div>
</div>
</section>
<section id="attributeerrors">
<h4>AttributeErrors<a class="headerlink" href="#attributeerrors" title="連結到這個標頭">¶</a></h4>
<p>當印出 <a class="reference internal" href="../library/exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> 時，<code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 將提供引發例外的物件中類似屬性名稱的建議：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">collections</span><span class="o">.</span><span class="n">namedtoplo</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">AttributeError</span>: <span class="n">module &#39;collections&#39; has no attribute &#39;namedtoplo&#39;. Did you mean: namedtuple?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38530">bpo-38530</a> 中貢獻。）</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>請注意，如果未呼叫 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 來顯示錯誤（可能為了要使用其他自定義錯誤顯示函式），則此操作將不起作用。這是 IPython 等某些 REPL 中的常見狀況。</p>
</div>
</section>
<section id="nameerrors">
<h4>NameErrors<a class="headerlink" href="#nameerrors" title="連結到這個標頭">¶</a></h4>
<p>當印出直譯器引發的 <a class="reference internal" href="../library/exceptions.html#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a> 時，<code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 將在引發例外的函式中提供類似變數名稱的建議：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">schwarzschild_black_hole</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schwarschild_black_hole</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">NameError</span>: <span class="n">name &#39;schwarschild_black_hole&#39; is not defined. Did you mean: schwarzschild_black_hole?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38530">bpo-38530</a> 中貢獻。）</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>請注意，如果未呼叫 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 來顯示錯誤，則此操作將不起作用，如果使用其他自定義錯誤顯示函式，則可能會發生這種情況。這是 IPython 等某些 REPL 中的常見場景。</p>
</div>
</section>
</section>
<section id="pep-626-precise-line-numbers-for-debugging-and-other-tools">
<h3>PEP 626：用於除錯和其他工具的精確列號<a class="headerlink" href="#pep-626-precise-line-numbers-for-debugging-and-other-tools" title="連結到這個標頭">¶</a></h3>
<p>PEP 626 為除錯、分析 (profiling) 和覆蓋 (coverage) 工具帶來了更精確、更可靠的列號 (line numbers)。為所有已執行的程式碼列且僅針對已執行的程式碼行產生具有正確列號的追蹤事件。</p>
<p>影格 (frame) 物件的 <a class="reference internal" href="../reference/datamodel.html#frame.f_lineno" title="frame.f_lineno"><code class="xref py py-attr docutils literal notranslate"><span class="pre">f_lineno</span></code></a> 屬性總會包含預期的列號。</p>
<p><a class="reference internal" href="../reference/datamodel.html#code-objects"><span class="std std-ref">程式碼物件</span></a>的 <a class="reference internal" href="../reference/datamodel.html#codeobject.co_lnotab" title="codeobject.co_lnotab"><code class="xref py py-attr docutils literal notranslate"><span class="pre">co_lnotab</span></code></a> 屬性已棄用，並將在 3.12 中刪除。需要從偏移量轉換為列號的程式碼應使用新的 <a class="reference internal" href="../reference/datamodel.html#codeobject.co_lines" title="codeobject.co_lines"><code class="xref py py-meth docutils literal notranslate"><span class="pre">co_lines()</span></code></a> 方法。</p>
</section>
<section id="pep-634-structural-pattern-matching">
<h3>PEP 634：結構模式匹配<a class="headerlink" href="#pep-634-structural-pattern-matching" title="連結到這個標頭">¶</a></h3>
<p>已新增結構模式匹配 (structural pattern matching)，其形式為具有關聯操作之模式的 <em>match 陳述式</em> 和 <em>case 陳述式</em>。模式由序列、對映、原始資料型別 (primitive data types) 以及類別實例組成。模式匹配使程式能夠從複雜的資料型別中提取資訊，在資料結構上進行分支，並根據不同形式的資料應用特定的操作。</p>
<section id="syntax-and-operations">
<h4>語法和操作<a class="headerlink" href="#syntax-and-operations" title="連結到這個標頭">¶</a></h4>
<p>模式匹配的通用語法是：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">subject</span><span class="p">:</span>
    <span class="k">case</span> <span class="o">&lt;</span><span class="n">pattern_1</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_1</span><span class="o">&gt;</span>
    <span class="k">case</span> <span class="o">&lt;</span><span class="n">pattern_2</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_2</span><span class="o">&gt;</span>
    <span class="k">case</span> <span class="o">&lt;</span><span class="n">pattern_3</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_3</span><span class="o">&gt;</span>
    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_wildcard</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>match 陳述式採用一個運算式，並將其值與作為一個或多個 case 區塊給出的連續模式進行比較。具體來說，模式匹配是透過以下方式進行操作：</p>
<ol class="arabic simple">
<li><p>使用具有型態 (type) 和特徵 (shape) 的資料 (主語 <code class="docutils literal notranslate"><span class="pre">subject</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">match</span></code> 陳述式中 <code class="docutils literal notranslate"><span class="pre">subject</span></code> 的求值 (evaluating)</p></li>
<li><p>從上到下將主語與 <code class="docutils literal notranslate"><span class="pre">case</span></code> 陳述式中的每個模式進行比較，直到確認匹配。</p></li>
<li><p>執行與已確認匹配模式對應的操作</p></li>
<li><p>如果未確認完全匹配，則最後一種情況，即萬用字元 <code class="docutils literal notranslate"><span class="pre">_</span></code> （如果有提供）將作為匹配到的情況。如未有任何匹配且不存在萬用字元的 case，則整個 match 區塊會是個無操作 (no-op)。</p></li>
</ol>
</section>
<section id="declarative-approach">
<h4>宣告式方法 (Declarative approach)<a class="headerlink" href="#declarative-approach" title="連結到這個標頭">¶</a></h4>
<p>讀者可能會透過使用 C、Java 或 JavaScript（以及許多其他語言）中的 switch 陳述式將主語（資料物件）與字面值 (literal)（模式）進行匹配的簡單範例來了解模式匹配。 switch 語句通常用於將物件/運算式與包含字面值的 case 陳述式進行比較。</p>
<p>更強大的模式匹配範例可以在 Scala 和 Elixir 等語言中找到。對於結構模式匹配，該方法是「宣告式的 (declarative)」，並且明確地說明了資料匹配的條件（模式）。</p>
<p>雖然使用巢狀 &quot;if&quot; 陳述式的「命令式 (imperative)」指令系列可用於完成類似於結構模式匹配的操作，但它不如「聲明式 (declarative)」方法清晰。相反地，「聲明式」方法規定了匹配所需滿足的條件，並且因其明確表達模式而更具可讀性。雖然結構模式匹配可以用其最簡單的形式達成，將變數與 case 陳述式中的字面值進行比較，但它對 Python 的真正價值在於它對主語的型態和特徵的處理。</p>
</section>
<section id="simple-pattern-match-to-a-literal">
<h4>簡單模式：與字面值匹配<a class="headerlink" href="#simple-pattern-match-to-a-literal" title="連結到這個標頭">¶</a></h4>
<p>讓我們將此範例視為最簡單形式的模式匹配：一個值（主語）與多個文字（模式）匹配。在下面的範例中，<code class="docutils literal notranslate"><span class="pre">status</span></code> 是匹配陳述式的主語。這些模式是每個 case 陳述式，其中文字表示請求狀態程式碼。與案例相關的操作在匹配後執行：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">http_error</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">status</span><span class="p">:</span>
        <span class="k">case</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Bad request&quot;</span>
        <span class="k">case</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Not found&quot;</span>
        <span class="k">case</span> <span class="mi">418</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;I&#39;m a teapot&quot;</span>
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Something&#39;s wrong with the internet&quot;</span>
</pre></div>
</div>
<p>如果上面的函式傳遞了 418 <code class="docutils literal notranslate"><span class="pre">status</span></code>，則回傳 &quot;I'm a teapot&quot;。如果上面的函式傳遞了 500 <code class="docutils literal notranslate"><span class="pre">status</span></code>，則帶有 <code class="docutils literal notranslate"><span class="pre">_</span></code> 的 case 語句將作為萬用字元進行匹配，並回傳 &quot;Something's wrong with the internet&quot;。請注意最後一個區塊：變數名稱 <code class="docutils literal notranslate"><span class="pre">_</span></code> 充當 <em>萬用字元</em> 並確保主語始終匹配。<code class="docutils literal notranslate"><span class="pre">_</span></code> 的使用是可選的。</p>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">|</span></code> (&quot;or&quot;) 將多個字面值組合在一個模式中：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="mi">401</span> <span class="o">|</span> <span class="mi">403</span> <span class="o">|</span> <span class="mi">404</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;Not allowed&quot;</span>
</pre></div>
</div>
<section id="behavior-without-the-wildcard">
<h5>沒有萬用字元 (wildcard) 的行為<a class="headerlink" href="#behavior-without-the-wildcard" title="連結到這個標頭">¶</a></h5>
<p>如果我們透過刪除最後一個 case 區塊來修改上面的範例，則範例將變為：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">http_error</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">status</span><span class="p">:</span>
        <span class="k">case</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Bad request&quot;</span>
        <span class="k">case</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Not found&quot;</span>
        <span class="k">case</span> <span class="mi">418</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;I&#39;m a teapot&quot;</span>
</pre></div>
</div>
<p>如果在 case 陳述式中不使用 <code class="docutils literal notranslate"><span class="pre">_</span></code>，則可能不存在匹配項目。如果不存在匹配項目，則該行為是無操作 (no-op)。例如，如果 <code class="docutils literal notranslate"><span class="pre">status</span></code> 為 500，則不會有任何操作。</p>
</section>
</section>
<section id="patterns-with-a-literal-and-variable">
<h4>具有字面值和變數的模式<a class="headerlink" href="#patterns-with-a-literal-and-variable" title="連結到這個標頭">¶</a></h4>
<p>模式看起來就像解包賦值 (unpacking assignment)，並且模式可用於繫結 (bind) 變數。在此範例中，可以將資料點解包為其 x 坐標和 y 坐標：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># point is an (x, y) tuple</span>
<span class="k">match</span> <span class="n">point</span><span class="p">:</span>
    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Origin&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not a point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>第一個模式有兩個字面值 <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0)</span></code>，並且可以被認為是上面顯示的字面值模式的擴充。接下來的兩個模式組合了一個字面值和一個變數，並且變數<em>繫結</em>來自主語（<code class="docutils literal notranslate"><span class="pre">point</span></code>）的值。第四個模式捕獲兩個值，這使得它在概念上類似於解包賦值 <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">point</span></code>。</p>
</section>
<section id="patterns-and-classes">
<h4>模式和類別<a class="headerlink" href="#patterns-and-classes" title="連結到這個標頭">¶</a></h4>
<p>如果你使用類別來建構資料，則可以用類別名稱與後面的引數列表組合成的建構函式作為模式。該模式能夠將類別屬性捕獲到變數中：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">point</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Origin is the point&#39;s location.&quot;</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> and the point is on the y-axis.&quot;</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> and the point is on the x-axis.&quot;</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The point is located somewhere else on the plane.&quot;</span><span class="p">)</span>
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not a point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="patterns-with-positional-parameters">
<h5>具有位置參數的模式<a class="headerlink" href="#patterns-with-positional-parameters" title="連結到這個標頭">¶</a></h5>
<p>你可以將位置參數與一些會為其屬性排序的內建類別（例如 dataclasses）一起使用。你還可以通過在類別中設定 <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> 特殊屬性來定義模式中屬性的特定位置。如果它被設定為 (&quot;x&quot;, &quot;y&quot;)，則以下模式都是等效的（且都將 <code class="docutils literal notranslate"><span class="pre">y</span></code> 屬性繫結到 <code class="docutils literal notranslate"><span class="pre">var</span></code> 變數）：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
<span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
<span class="n">Point</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="nested-patterns">
<h4>巢狀模式<a class="headerlink" href="#nested-patterns" title="連結到這個標頭">¶</a></h4>
<p>模式可以任意巢套。例如，如果我們的資料是一個簡短的座標點列表，則可以這樣匹配：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">points</span><span class="p">:</span>
    <span class="k">case</span> <span class="p">[]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No points in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The origin is the only point in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A single point </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> is in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Two points on the Y axis at </span><span class="si">{</span><span class="n">y1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y2</span><span class="si">}</span><span class="s2"> are in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Something else is found in the list.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="complex-patterns-and-the-wildcard">
<h4>複雜模式和萬用字元<a class="headerlink" href="#complex-patterns-and-the-wildcard" title="連結到這個標頭">¶</a></h4>
<p>到目前為止，範例在最後一個 case 陳述式中單獨使用了 <code class="docutils literal notranslate"><span class="pre">_</span></code>。萬用字元可以用在更複雜的模式中，像是 <code class="docutils literal notranslate"><span class="pre">('error',</span> <span class="pre">code,</span> <span class="pre">_)</span></code>。例如：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">test_variable</span><span class="p">:</span>
    <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A warning has been received.&quot;</span><span class="p">)</span>
    <span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="k">_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> occurred.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>在上述情況下，值像是 ('error', code, 100) 和 ('error', code, 800) 的 <code class="docutils literal notranslate"><span class="pre">test_variable</span></code> 將會成功匹配。</p>
</section>
<section id="guard">
<h4>Guard<a class="headerlink" href="#guard" title="連結到這個標頭">¶</a></h4>
<p>我們可以在模式中新增一個 <code class="docutils literal notranslate"><span class="pre">if</span></code> 子句，稱為 &quot;guard&quot;。如果 guard 為 false，則 <code class="docutils literal notranslate"><span class="pre">match</span></code> 會繼續嘗試下一個 case 區塊。請注意，值的捕獲發生在 guard 的求值 (evaluate) 之前：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">point</span><span class="p">:</span>
    <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The point is located on the diagonal Y=X at </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Point is not on the diagonal.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="other-key-features">
<h4>其他主要功能<a class="headerlink" href="#other-key-features" title="連結到這個標頭">¶</a></h4>
<p>其他幾個主要功能：</p>
<ul>
<li><p>與賦值的解包一樣，tuple 和 list 模式具有完全相同的含義，並且實際上匹配任意序列。從技術上來說，主語必須是一個序列。因此，一個重要的例外是模式不會去匹配疊代器。另外，為了防止常常出錯，序列模式也不會去匹配字串。</p></li>
<li><p>序列模式支援萬用字元：<code class="docutils literal notranslate"><span class="pre">[x,</span> <span class="pre">y,</span> <span class="pre">*rest]</span></code> 和 <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">*rest)</span></code> 與解包賦值中的萬用字元類似。 <code class="docutils literal notranslate"><span class="pre">*</span></code> 後面的名稱也可能是 <code class="docutils literal notranslate"><span class="pre">_</span></code>，因此 <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">*_)</span></code> 會匹配至少兩個項目的序列，且不繫結其餘項目。</p></li>
<li><p>對映模式： <code class="docutils literal notranslate"><span class="pre">{&quot;bandwidth&quot;:</span> <span class="pre">b,</span> <span class="pre">&quot;latency&quot;:</span> <span class="pre">l}</span></code> 從字典中捕獲 <code class="docutils literal notranslate"><span class="pre">&quot;bandwidth&quot;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&quot;latency&quot;</span></code> 值。與序列模式不同，額外的鍵將被忽略。也支援萬用字元 <code class="docutils literal notranslate"><span class="pre">**rest</span></code>。（但是 <code class="docutils literal notranslate"><span class="pre">**_</span></code> 是多餘的，所以是不允許的。）</p></li>
<li><p>可以使用 <code class="docutils literal notranslate"><span class="pre">as</span></code> 關鍵字捕獲子模式：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="k">as</span> <span class="n">p2</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p>這將繫結 x1、y1、x2、y2，如同沒有 <code class="docutils literal notranslate"><span class="pre">as</span></code> 子句的情況下所預期的，並將 p2 繫結到主語的整個第二項目。</p>
</li>
<li><p>大多數字面值都是通過相等進行比較的。然而，單例 <code class="docutils literal notranslate"><span class="pre">True</span></code>、<code class="docutils literal notranslate"><span class="pre">False</span></code> 和 <code class="docutils literal notranslate"><span class="pre">None</span></code> 是按標識值 (identity) 來進行比較的。</p></li>
<li><p>附名常數 (named constant) 可以在模式中使用。這些附名常數必須有帶有點的名稱 (dotted name)，以防止常數被直譯為捕獲的變數：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span>
<span class="k">match</span> <span class="n">color</span><span class="p">:</span>
    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I see red!&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grass is green&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLUE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m feeling the blues :(&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>有關完整規範，請參閱 <span class="target" id="index-95"></span><a class="pep reference external" href="https://peps.python.org/pep-0634/"><strong>PEP 634</strong></a>。動機和基本原理位於 <span class="target" id="index-96"></span><a class="pep reference external" href="https://peps.python.org/pep-0635/"><strong>PEP 635</strong></a> 中，較完整的教學位於 <span class="target" id="index-97"></span><a class="pep reference external" href="https://peps.python.org/pep-0636/"><strong>PEP 636</strong></a> 中。</p>
</section>
</section>
<section id="optional-encodingwarning-and-encoding-locale-option">
<span id="whatsnew310-pep597"></span><h3>可選的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code> 和 <code class="docutils literal notranslate"><span class="pre">encoding=&quot;locale&quot;</span></code> 選項<a class="headerlink" href="#optional-encodingwarning-and-encoding-locale-option" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/io.html#io.TextIOWrapper" title="io.TextIOWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextIOWrapper</span></code></a> 和 <a class="reference internal" href="../library/functions.html#open" title="open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a> 的預設編碼取決於平台和區域設定。由於大多數 Unix 平台都使用 UTF-8，因此在打開 UTF-8 檔案（例如 JSON、YAML、TOML、Markdown）時省略 <code class="docutils literal notranslate"><span class="pre">encoding</span></code> 選項是個常見的 bug，例如：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># BUG: &quot;rb&quot; mode or encoding=&quot;utf-8&quot; should be used.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>為了發現這種錯誤，新增了一個可選的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code>。當 <a class="reference internal" href="../library/sys.html#sys.flags" title="sys.flags"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.flags.warn_default_encoding</span></code></a> 為 true 且使用特定於語言環境的預設編碼時，會發出該信號。</p>
<p>新增 <code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">warn_default_encoding</span></code> 選項和 <span class="target" id="index-98"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNDEFAULTENCODING"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONWARNDEFAULTENCODING</span></code></a> 來啟用警告。</p>
<p>更多資訊請見 <a class="reference internal" href="../library/io.html#io-text-encoding"><span class="std std-ref">文字編碼</span></a>。</p>
</section>
</section>
<section id="new-features-related-to-type-hints">
<span id="new-feat-related-type-hints"></span><h2>與型別提示相關的新功能<a class="headerlink" href="#new-features-related-to-type-hints" title="連結到這個標頭">¶</a></h2>
<p>本節介紹影響 <span class="target" id="index-99"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> 型別提示和 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模組的主要更改。</p>
<section id="pep-604-new-type-union-operator">
<h3>PEP 604：新型聯集運算子<a class="headerlink" href="#pep-604-new-type-union-operator" title="連結到這個標頭">¶</a></h3>
<p>引入了一種新的聯集運算子，該運算子啟用像是 <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">|</span> <span class="pre">Y</span></code> 的語法。這提供了一種在型別提示中更清晰的方式來表達「型別 X 或型別 Y」，來取代使用 <a class="reference internal" href="../library/typing.html#typing.Union" title="typing.Union"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code></a>。</p>
<p>在以前版本的 Python 中，要使用接受多種型別參數之型別提示的函式，要使用 <a class="reference internal" href="../library/typing.html#typing.Union" title="typing.Union"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code></a>：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>現在可以用更簡潔的方式編寫型別提示：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>這種新語法也接受作為 <a class="reference internal" href="../library/functions.html#isinstance" title="isinstance"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#issubclass" title="issubclass"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a> 的第二個引數：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>更多資訊請見 <a class="reference internal" href="../library/stdtypes.html#types-union"><span class="std std-ref">Union Type</span></a> 與 <span class="target" id="index-100"></span><a class="pep reference external" href="https://peps.python.org/pep-0604/"><strong>PEP 604</strong></a>。</p>
<p>（由 Maggie Moss 和 Philippe Prados 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41428">bpo-41428</a> 中貢獻，由 Yurii Karabas 和 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44490">bpo-44490</a> 中補充。）</p>
</section>
<section id="pep-612-parameter-specification-variables">
<h3>PEP 612：參數規範變數<a class="headerlink" href="#pep-612-parameter-specification-variables" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模組中新增了兩個新選項，用於改進為 <span class="target" id="index-101"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> <code class="docutils literal notranslate"><span class="pre">Callable</span></code> 的靜態型別檢查器 (static type checker) 所提供的資訊。</p>
<p>第一個是參數規範變數 (parameter specification variable)。它們用於將一個可呼叫物件的參數型別轉發到另一個可呼叫物件 -- 這是高階函式和裝飾器中常見的模式。使用範例可以在 <a class="reference internal" href="../library/typing.html#typing.ParamSpec" title="typing.ParamSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpec</span></code></a> 中找到。在過去是沒有簡單的方法可以如此精確地來為參數型別的依賴關係做型別註釋。</p>
<p>第二個選項是新的 <code class="docutils literal notranslate"><span class="pre">Concatenate</span></code> 運算子。它與參數規範變數結合使用，來對一個高階、會新增或刪除另一個可呼叫物件參數的可呼叫物件進行型別註釋。使用範例可以在 <a class="reference internal" href="../library/typing.html#typing.Concatenate" title="typing.Concatenate"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Concatenate</span></code></a> 中找到。</p>
<p>請參閱 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Callable</span></code></a>、<a class="reference internal" href="../library/typing.html#typing.ParamSpec" title="typing.ParamSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpec</span></code></a>、<a class="reference internal" href="../library/typing.html#typing.Concatenate" title="typing.Concatenate"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Concatenate</span></code></a>、<a class="reference internal" href="../library/typing.html#typing.ParamSpecArgs" title="typing.ParamSpecArgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpecArgs</span></code></a>、<a class="reference internal" href="../library/typing.html#typing.ParamSpecKwargs" title="typing.ParamSpecKwargs"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpecKwargs</span></code></a> 和 <span class="target" id="index-102"></span><a class="pep reference external" href="https://peps.python.org/pep-0612/"><strong>PEP 612</strong></a> 以了解更多詳情。</p>
<p>（由 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41559">bpo-41559</a> 中貢獻、Jelle Zijlstra 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43783">bpo-43783</a> 中進行了小幅改進。PEP 由 Mark Mendoza 編寫。）</p>
</section>
<section id="pep-613-typealias">
<h3>PEP 613：型別別名 (TypeAlias)<a class="headerlink" href="#pep-613-typealias" title="連結到這個標頭">¶</a></h3>
<p><span class="target" id="index-103"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> 引入了型別別名 (type aliases) 的概念，只要求它們是最高階、未註釋的賦值 (top-level unannotated assignments)。這種簡單性有時使型別檢查器難以區分型別別名和普通賦值，尤其是在涉及傳遞參照 (reference) 或無效型別時。比較如下：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">StrCache</span> <span class="o">=</span> <span class="s1">&#39;Cache[str]&#39;</span>  <span class="c1"># a type alias</span>
<span class="n">LOG_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;LOG[DEBUG]&#39;</span>  <span class="c1"># a module constant</span>
</pre></div>
</div>
<p>現在 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模組有一個特殊值 <a class="reference internal" href="../library/typing.html#typing.TypeAlias" title="typing.TypeAlias"><code class="xref py py-data docutils literal notranslate"><span class="pre">TypeAlias</span></code></a>，它可以讓你更明確地宣告型別別名：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">StrCache</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="s1">&#39;Cache[str]&#39;</span>  <span class="c1"># a type alias</span>
<span class="n">LOG_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;LOG[DEBUG]&#39;</span>  <span class="c1"># a module constant</span>
</pre></div>
</div>
<p>更多資訊請見 <span class="target" id="index-104"></span><a class="pep reference external" href="https://peps.python.org/pep-0613/"><strong>PEP 613</strong></a>。</p>
<p>（由 Mikhail Golubev 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41923">bpo-41923</a> 中貢獻。）</p>
</section>
<section id="pep-647-user-defined-type-guards">
<h3>PEP 647：使用者定義的型別防護<a class="headerlink" href="#pep-647-user-defined-type-guards" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/typing.html#typing.TypeGuard" title="typing.TypeGuard"><code class="xref py py-data docutils literal notranslate"><span class="pre">TypeGuard</span></code></a>（型別防護）已新增到 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模組中，用以註釋型別防護函式並改進在型別窄縮 (type narrowing) 期間提供給靜態型別檢查器的資訊。有關更多資訊，請參閱 <a class="reference internal" href="../library/typing.html#typing.TypeGuard" title="typing.TypeGuard"><code class="xref py py-data docutils literal notranslate"><span class="pre">TypeGuard</span></code></a> 的文件和 <span class="target" id="index-105"></span><a class="pep reference external" href="https://peps.python.org/pep-0647/"><strong>PEP 647</strong></a>。</p>
<p>（由 Ken Jin 和 Guido van Rossum 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43766">bpo-43766</a> 中貢獻。PEP 由 Eric Traut 編寫。）</p>
</section>
</section>
<section id="other-language-changes">
<h2>其他語言更動<a class="headerlink" href="#other-language-changes" title="連結到這個標頭">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> 型別有一個新方法 <a class="reference internal" href="../library/stdtypes.html#int.bit_count" title="int.bit_count"><code class="xref py py-meth docutils literal notranslate"><span class="pre">int.bit_count()</span></code></a>，回傳給定整數的二進位展開式中 1 的數量，也稱為總體計數 (population count)。（由 Niklas Fiekas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=29882">bpo-29882</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.keys()</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.values()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.items()</span></code></a> 回傳的視圖 (view) 現在都有一個 <code class="docutils literal notranslate"><span class="pre">mapping</span></code> 屬性，該屬性提供 <a class="reference internal" href="../library/types.html#types.MappingProxyType" title="types.MappingProxyType"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.MappingProxyType</span></code></a> 包裝原始的字典物件。（由 Dennis Sweeney 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40890">bpo-40890</a> 中貢獻。）</p></li>
<li><p><span class="target" id="index-106"></span><a class="pep reference external" href="https://peps.python.org/pep-0618/"><strong>PEP 618</strong></a>：<a class="reference internal" href="../library/functions.html#zip" title="zip"><code class="xref py py-func docutils literal notranslate"><span class="pre">zip()</span></code></a> 函式現在有一個可選的 <code class="docutils literal notranslate"><span class="pre">strict</span></code> 旗標，用於要求所有可疊代物件具有相同的長度。</p></li>
<li><p>採用整數引數的內建函式和擴充函式不再接受 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decimal</span></code></a>、<a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fraction</span></code></a> 以及其他只能在有損失的情況下轉換為整數的物件（例如有 <a class="reference internal" href="../reference/datamodel.html#object.__int__" title="object.__int__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__int__()</span></code></a> 方法，但沒有 <a class="reference internal" href="../reference/datamodel.html#object.__index__" title="object.__index__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__index__()</span></code></a> 方法）。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37999">bpo-37999</a> 中貢獻。）</p></li>
<li><p>如果 <a class="reference internal" href="../reference/datamodel.html#object.__ipow__" title="object.__ipow__"><code class="xref py py-func docutils literal notranslate"><span class="pre">object.__ipow__()</span></code></a> 回傳 <a class="reference internal" href="../library/constants.html#NotImplemented" title="NotImplemented"><code class="xref py py-data docutils literal notranslate"><span class="pre">NotImplemented</span></code></a>，則該運算子將按預期正確回退到 <a class="reference internal" href="../reference/datamodel.html#object.__pow__" title="object.__pow__"><code class="xref py py-func docutils literal notranslate"><span class="pre">object.__pow__()</span></code></a> 和 <a class="reference internal" href="../reference/datamodel.html#object.__rpow__" title="object.__rpow__"><code class="xref py py-func docutils literal notranslate"><span class="pre">object.__rpow__()</span></code></a> 。（由 Alex Shkop 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38302">bpo-38302</a> 中貢獻。）</p></li>
<li><p>現在可以在集合字面值 (set literals) 和集合綜合運算 (set comprehensions) 以及序列索引（但不能是切片）中使用不帶括號的賦值運算式 (assignment expressions)。</p></li>
<li><p>函式有一個新的 <code class="docutils literal notranslate"><span class="pre">__builtins__</span></code> 屬性，用於在執行函式時查找內建符號，而不是查找 <code class="docutils literal notranslate"><span class="pre">__globals__['__builtins__']</span></code> 。如果 <code class="docutils literal notranslate"><span class="pre">__globals__[&quot;__builtins__&quot;]</span></code> 存在，則屬性會以此做初始化，否則從當前內建物件 (builtins) 初始化。（由 Mark Shannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42990">bpo-42990</a> 中貢獻。）</p></li>
<li><p>新增兩個內建函式 -- <a class="reference internal" href="../library/functions.html#aiter" title="aiter"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiter()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#anext" title="anext"><code class="xref py py-func docutils literal notranslate"><span class="pre">anext()</span></code></a>，分別為 <a class="reference internal" href="../library/functions.html#iter" title="iter"><code class="xref py py-func docutils literal notranslate"><span class="pre">iter()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#next" title="next"><code class="xref py py-func docutils literal notranslate"><span class="pre">next()</span></code></a> 提供非同步的對應函式。（由 Joshua Bronson、Daniel Pope 和 Justin Wang 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31861">bpo-31861</a> 中貢獻。）</p></li>
<li><p>靜態方法 (<a class="reference internal" href="../library/functions.html#staticmethod" title="staticmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;staticmethod</span></code></a>) 和類別方法 (<a class="reference internal" href="../library/functions.html#classmethod" title="classmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;classmethod</span></code></a>) 現在繼承方法屬性 (<code class="docutils literal notranslate"><span class="pre">__module__</span></code>, <code class="docutils literal notranslate"><span class="pre">__name__</span></code>, <code class="docutils literal notranslate"><span class="pre">__qualname__</span></code>, <code class="docutils literal notranslate"><span class="pre">__doc__</span></code>, <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code>) 並有一個新的 <code class="docutils literal notranslate"><span class="pre">__wrapped__</span></code> 屬性。此外，靜態方法現在可以像是常規函式般呼叫。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43682">bpo-43682</a> 中貢獻。）</p></li>
<li><p>複雜目標（除 <span class="target" id="index-107"></span><a class="pep reference external" href="https://peps.python.org/pep-0526/"><strong>PEP 526</strong></a> 定義的 <code class="docutils literal notranslate"><span class="pre">simple</span> <span class="pre">name</span></code> 目標之外的所有內容）的註釋不再使用 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">comments</span></code> 造成任何執行環境 (runtime) 影響。（由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42737">bpo-42737</a> 中貢獻。）</p></li>
<li><p>類別和模組物件現在會根據需求來延遲建立 (lazy-create) 空的註釋字典 (annotations dicts)。註釋字典存儲在物件的 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中以達成向後相容性。這改進了 <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code> 使用方式的最佳實踐方法；有關更多資訊，請參閱 <a class="reference internal" href="../howto/annotations.html#annotations-howto"><span class="std std-ref">註釋 (annotation) 最佳實踐</span></a>。（由 Larry Hastings 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43901">bpo-43901</a> 中貢獻。）</p></li>
<li><p>附名運算式或由 <code class="docutils literal notranslate"><span class="pre">yield</span></code>、<code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code>、<code class="docutils literal notranslate"><span class="pre">await</span></code> 組成的註釋現在在 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">comments</span></code> 下被禁止，因為它們有些不預期的行為。（由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42725">bpo-42725</a> 中貢獻。）</p></li>
<li><p>未繫結變數 (unbound variable)、<code class="docutils literal notranslate"><span class="pre">super()</span></code> 和其他可能會改變處理註釋之符號表 (symbol table) 的運算式，現在在 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">comments</span></code> 下變得無效。（由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42725">bpo-42725</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> 型別和 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">decimal.Decimal</span></code></a> 型別的 NaN 值的雜湊值現在取決於物件的標識值 (identity)。以前即使 NaN 值彼此不相等，它們也總是被雜湊為 <code class="docutils literal notranslate"><span class="pre">0</span></code>。由於在建立包含多個 NaN 的字典和集合時出現過多的雜湊衝突 (hash collision)，可能導致潛在的二次方執行環境行為 (quadratic runtime behavior)。（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43475">bpo-43475</a> 中貢獻。）</p></li>
<li><p>刪除 <a class="reference internal" href="../library/constants.html#debug__" title="__debug__"><code class="xref py py-const docutils literal notranslate"><span class="pre">__debug__</span></code></a> 常數時將引發 <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> （而不是 <a class="reference internal" href="../library/exceptions.html#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a>）。（由 Donghee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=45000">bpo-45000</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 例外現在具有 <code class="docutils literal notranslate"><span class="pre">end_lineno</span></code> 和 <code class="docutils literal notranslate"><span class="pre">end_offset</span></code> 屬性。如果未被決定，它們將會是 <code class="docutils literal notranslate"><span class="pre">None</span></code>。（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43914">bpo-43914</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="new-modules">
<h2>新模組<a class="headerlink" href="#new-modules" title="連結到這個標頭">¶</a></h2>
<ul class="simple">
<li><p>無。</p></li>
</ul>
</section>
<section id="improved-modules">
<h2>改進的模組<a class="headerlink" href="#improved-modules" title="連結到這個標頭">¶</a></h2>
<section id="asyncio">
<h3>asyncio<a class="headerlink" href="#asyncio" title="連結到這個標頭">¶</a></h3>
<p>新增缺少的 <code class="xref py py-meth docutils literal notranslate"><span class="pre">connect_accepted_socket()</span></code> 方法。（由 Alex Grönholm 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41332">bpo-41332</a> 中貢獻。）</p>
</section>
<section id="argparse">
<h3>argparse<a class="headerlink" href="#argparse" title="連結到這個標頭">¶</a></h3>
<p>argparse 幫助中的誤導性用詞「可選引數 (optional arguments)」已被替換為「選項 (options)」。某些依賴於精確輸出匹配的測試可能需要進行調整。（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9694">bpo-9694</a> 中貢獻。）</p>
</section>
<section id="array">
<h3>array<a class="headerlink" href="#array" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/array.html#array.array" title="array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array.array</span></code></a> 的 <a class="reference internal" href="../library/array.html#array.array.index" title="array.array.index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">index()</span></code></a> 方法現在具有可選的 <em>start</em> 和 <em>stop</em> 參數。（由 Anders Lorentsen 和 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31956">bpo-31956</a> 中貢獻。）</p>
</section>
<section id="asynchat-asyncore-smtpd">
<h3>asynchat, asyncore, smtpd<a class="headerlink" href="#asynchat-asyncore-smtpd" title="連結到這個標頭">¶</a></h3>
<p>自 Python 3.6 起，這些模組在其文件中被標記為已棄用。引入時的 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 現已新增到這三個模組中。</p>
</section>
<section id="base64">
<h3>base64<a class="headerlink" href="#base64" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/base64.html#base64.b32hexencode" title="base64.b32hexencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">base64.b32hexencode()</span></code></a> 和 <a class="reference internal" href="../library/base64.html#base64.b32hexdecode" title="base64.b32hexdecode"><code class="xref py py-func docutils literal notranslate"><span class="pre">base64.b32hexdecode()</span></code></a> 以支援擴充十六進位字母的 Base32 編碼 (Base32 Encoding with Extended Hex Alphabet)。</p>
</section>
<section id="bdb">
<h3>bdb<a class="headerlink" href="#bdb" title="連結到這個標頭">¶</a></h3>
<p>新增 <code class="xref py py-meth docutils literal notranslate"><span class="pre">clearBreakpoints()</span></code> 來重置所有設定的斷點。（由 Irit Katriel 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=24160">bpo-24160</a> 中貢獻。）</p>
</section>
<section id="bisect">
<h3>bisect<a class="headerlink" href="#bisect" title="連結到這個標頭">¶</a></h3>
<p>新增向 <a class="reference internal" href="../library/bisect.html#module-bisect" title="bisect: Array bisection algorithms for binary searching."><code class="xref py py-mod docutils literal notranslate"><span class="pre">bisect</span></code></a> 模組 API 提供 <em>key</em> 函式的可能性。（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4356">bpo-4356</a> 中貢獻。）</p>
</section>
<section id="codecs">
<h3>codecs<a class="headerlink" href="#codecs" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/codecs.html#codecs.unregister" title="codecs.unregister"><code class="xref py py-func docutils literal notranslate"><span class="pre">codecs.unregister()</span></code></a> 函式來取消註冊 (unregister) 一個編解碼器的搜索功能。（Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41842">bpo-41842</a> 中貢獻。）</p>
</section>
<section id="collections-abc">
<h3>collections.abc<a class="headerlink" href="#collections-abc" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 的<a class="reference internal" href="../library/stdtypes.html#types-genericalias"><span class="std std-ref">參數化泛型 (parameterized generic)</span></a> 的 <code class="docutils literal notranslate"><span class="pre">__args__</span></code> 現在與 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Callable</span></code></a> 一致。<a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 泛型現在會將型別參數攤平，類似於 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Callable</span></code></a> 目前的做法。這意味著 <code class="docutils literal notranslate"><span class="pre">collections.abc.Callable[[int,</span> <span class="pre">str],</span> <span class="pre">str]</span></code> 將具有 <code class="docutils literal notranslate"><span class="pre">(int,</span> <span class="pre">str,</span> <span class="pre">str)</span></code> 的 <code class="docutils literal notranslate"><span class="pre">__args__</span></code>；在以前這是 <code class="docutils literal notranslate"><span class="pre">([int,</span> <span class="pre">str],</span> <span class="pre">str)</span></code>。為了允許此更改，現在可以對 <a class="reference internal" href="../library/types.html#types.GenericAlias" title="types.GenericAlias"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.GenericAlias</span></code></a> 進行子類別化，並且在下標 (subscript) <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 型別時將回傳子類別。請注意，對於無效形式的 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 參數化可能會引發 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>，而在 Python 3.9 中該參數可能會無引發例外地傳遞。（由 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42195">bpo-42195</a> 中貢獻。）</p>
</section>
<section id="contextlib">
<h3>contextlib<a class="headerlink" href="#contextlib" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/contextlib.html#contextlib.aclosing" title="contextlib.aclosing"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextlib.aclosing()</span></code></a> 情境管理器以安全地關閉非同步產生器和表示非同步釋放資源的物件。（由 Joongi Kim 和 John Belmonte 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41229">bpo-41229</a> 中貢獻。）</p>
<p>向 <a class="reference internal" href="../library/contextlib.html#contextlib.nullcontext" title="contextlib.nullcontext"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextlib.nullcontext()</span></code></a> 新增非同步情境管理器支援。（由 Tom Gringauz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41543">bpo-41543</a> 中貢獻。）</p>
<p>新增 <a class="reference internal" href="../library/contextlib.html#contextlib.AsyncContextDecorator" title="contextlib.AsyncContextDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncContextDecorator</span></code></a>，用於支援將非同步情境管理器作為裝飾器使用。</p>
</section>
<section id="curses">
<h3>curses<a class="headerlink" href="#curses" title="連結到這個標頭">¶</a></h3>
<p>ncurses 6.1 中新增的擴充顏色函式將由 <a class="reference internal" href="../library/curses.html#curses.color_content" title="curses.color_content"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.color_content()</span></code></a>、<a class="reference internal" href="../library/curses.html#curses.init_color" title="curses.init_color"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.init_color()</span></code></a>、<a class="reference internal" href="../library/curses.html#curses.init_pair" title="curses.init_pair"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.init_pair()</span></code></a> 和 <a class="reference internal" href="../library/curses.html#curses.pair_content" title="curses.pair_content"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.pair_content()</span></code></a> 透明地使用。新函式 <a class="reference internal" href="../library/curses.html#curses.has_extended_color_support" title="curses.has_extended_color_support"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.has_extended_color_support()</span></code></a> 表示了底層的 ncurses 函式庫是否支援擴充顏色。（由 Jeffrey Kintscher 和 Hans Petter Jansson 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36982">bpo-36982</a> 中貢獻。）</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">BUTTON5_*</span></code> 常數是由底層 <a class="reference internal" href="../library/curses.html#module-curses" title="curses: An interface to the curses library, providing portable terminal handling. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">curses</span></code></a> 函式庫提供的，那麼它們現在會在 curses 模組中公開。（由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39273">bpo-39273</a> 中貢獻。）</p>
</section>
<section id="dataclasses">
<h3>dataclasses<a class="headerlink" href="#dataclasses" title="連結到這個標頭">¶</a></h3>
<section id="slots">
<h4>__slots__<a class="headerlink" href="#slots" title="連結到這個標頭">¶</a></h4>
<p>在 <a class="reference internal" href="../library/dataclasses.html#dataclasses.dataclass" title="dataclasses.dataclass"><code class="xref py py-func docutils literal notranslate"><span class="pre">dataclasses.dataclass()</span></code></a> 裝飾器中新增了 <code class="docutils literal notranslate"><span class="pre">slots</span></code> 參數。（由 Yurii Karabas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42269">bpo-42269</a> 中貢獻）</p>
</section>
<section id="keyword-only-fields">
<h4>僅限關鍵字欄位 (Keyword-only fields)<a class="headerlink" href="#keyword-only-fields" title="連結到這個標頭">¶</a></h4>
<p>dataclasses 現在支援在產生的 __init__ 方法中包含僅限關鍵字的欄位。有多種方法可以指定僅限關鍵字欄位。</p>
<p>你可以說每個欄位都是關鍵字：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Birthday</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">birthday</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">birthday</span></code> 都是產生的 __init__ 方法的僅限關鍵字參數。</p>
<p>你可以在每個欄位的基礎上指定僅限關鍵字：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Birthday</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">birthday</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>這裡只有 <code class="docutils literal notranslate"><span class="pre">birthday</span></code> 是僅限關鍵字。如果你在各個欄位上設定 <code class="docutils literal notranslate"><span class="pre">kw_only</span></code>，請注意，由於僅限關鍵字欄位需要遵循非僅限關鍵字欄位，因此會有欄位重新排序的相關規則。詳細資訊請參閱完整的 dataclasses 文件。</p>
<p>你還可以指定 KW_ONLY 標記後面的所有欄位均為僅限關鍵字欄位。這可能是最常見的用法：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">KW_ONLY</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">KW_ONLY</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>這裡的 <code class="docutils literal notranslate"><span class="pre">z</span></code> 和 <code class="docutils literal notranslate"><span class="pre">t</span></code> 是僅限關鍵字參數，而 <code class="docutils literal notranslate"><span class="pre">x</span></code> 和 <code class="docutils literal notranslate"><span class="pre">y</span></code> 則不是。（由 Eric V. Smith 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43532">bpo-43532</a> 中貢獻。）</p>
</section>
</section>
<section id="distutils">
<span id="distutils-deprecated"></span><h3>distutils<a class="headerlink" href="#distutils" title="連結到這個標頭">¶</a></h3>
<p>整個 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 套件已被棄用，將在 Python 3.12 中刪除。它指定套件建置的功能已經完全被第三方套件 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 和 <code class="docutils literal notranslate"><span class="pre">packaging</span></code> 所取代，並且大多數其他常用的 API 都可以在標準函式庫的其他地方被找到（例如 <a class="reference internal" href="../library/platform.html#module-platform" title="platform: Retrieves as much platform identifying data as possible."><code class="xref py py-mod docutils literal notranslate"><span class="pre">platform</span></code></a> 、<a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shutil</span></code></a>、<a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: Subprocess management."><code class="xref py py-mod docutils literal notranslate"><span class="pre">subprocess</span></code></a> 或 <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sysconfig</span></code></a>）。目前沒有將 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 遷移任何其他地方的計畫，且使用其他功能的應用程式應該開始規劃如何取得程式碼的私有副本。請參閱 <span class="target" id="index-108"></span><a class="pep reference external" href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a> 的討論。</p>
<p>Python 3.8 中不推薦使用的 <code class="docutils literal notranslate"><span class="pre">bdist_wininst</span></code> 命令已被刪除。現在建議使用 <code class="docutils literal notranslate"><span class="pre">bdist_wheel</span></code> 命令來在 Windows 上發布二進位套件。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42802">bpo-42802</a> 中貢獻。）</p>
</section>
<section id="doctest">
<h3>doctest<a class="headerlink" href="#doctest" title="連結到這個標頭">¶</a></h3>
<p>當模組未定義 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> 時，回退到 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中貢獻。）</p>
</section>
<section id="encodings">
<h3>encodings<a class="headerlink" href="#encodings" title="連結到這個標頭">¶</a></h3>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">encodings.normalize_encoding()</span></code> 現在會忽略非 ASCII 字元。（Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39337">bpo-39337</a> 中貢獻。）</p>
</section>
<section id="enum">
<h3>enum<a class="headerlink" href="#enum" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/enum.html#enum.Enum" title="enum.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> <a class="reference internal" href="../reference/datamodel.html#object.__repr__" title="object.__repr__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__repr__()</span></code></a> 現在會回傳 <code class="docutils literal notranslate"><span class="pre">enum_name.member_name</span></code> 、<a class="reference internal" href="../reference/datamodel.html#object.__str__" title="object.__str__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__str__()</span></code></a> 現在會回傳 <code class="docutils literal notranslate"><span class="pre">member_name</span></code> 。可用作模組常數的標準函式庫列舉會有 <code class="docutils literal notranslate"><span class="pre">module_name.member_name</span></code> 的 <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a>。（由 Ethan Furman 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40066">bpo-40066</a> 中貢獻。）</p>
<p>新增 <a class="reference internal" href="../library/enum.html#enum.StrEnum" title="enum.StrEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.StrEnum</span></code></a>，為所有成員都是字串的列舉。（由 Ethan Furman 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41816">bpo-41816</a> 中貢獻。）</p>
</section>
<section id="fileinput">
<h3>fileinput<a class="headerlink" href="#fileinput" title="連結到這個標頭">¶</a></h3>
<p>在 <a class="reference internal" href="../library/fileinput.html#fileinput.input" title="fileinput.input"><code class="xref py py-func docutils literal notranslate"><span class="pre">fileinput.input()</span></code></a> 和 <a class="reference internal" href="../library/fileinput.html#fileinput.FileInput" title="fileinput.FileInput"><code class="xref py py-class docutils literal notranslate"><span class="pre">fileinput.FileInput</span></code></a> 中新增 <em>encoding</em> 和 <em>errors</em> 參數。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43712">bpo-43712</a> 中貢獻。）</p>
<p>當 <em>mode</em> 為 &quot;r&quot; 並且檔案有被壓縮時，<a class="reference internal" href="../library/fileinput.html#fileinput.hook_compressed" title="fileinput.hook_compressed"><code class="xref py py-func docutils literal notranslate"><span class="pre">fileinput.hook_compressed()</span></code></a> 現在會回傳 <a class="reference internal" href="../library/io.html#io.TextIOWrapper" title="io.TextIOWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextIOWrapper</span></code></a> 物件（和未壓縮檔案一樣）。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5758">bpo-5758</a> 中貢獻。）</p>
</section>
<section id="faulthandler">
<h3>faulthandler<a class="headerlink" href="#faulthandler" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/faulthandler.html#module-faulthandler" title="faulthandler: Dump the Python traceback."><code class="xref py py-mod docutils literal notranslate"><span class="pre">faulthandler</span></code></a> 模組現在可以檢測垃圾收集器 (garbage collector) 在收集期間是否發生嚴重錯誤。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44466">bpo-44466</a> 中貢獻。）</p>
</section>
<section id="gc">
<h3>gc<a class="headerlink" href="#gc" title="連結到這個標頭">¶</a></h3>
<p>為 <a class="reference internal" href="../library/gc.html#gc.get_objects" title="gc.get_objects"><code class="xref py py-func docutils literal notranslate"><span class="pre">gc.get_objects()</span></code></a>、<a class="reference internal" href="../library/gc.html#gc.get_referrers" title="gc.get_referrers"><code class="xref py py-func docutils literal notranslate"><span class="pre">gc.get_referrers()</span></code></a> 和 <a class="reference internal" href="../library/gc.html#gc.get_referents" title="gc.get_referents"><code class="xref py py-func docutils literal notranslate"><span class="pre">gc.get_referents()</span></code></a> 新增稽核掛鉤 (audit hooks)。（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43439">bpo-43439</a> 中貢獻。）</p>
</section>
<section id="glob">
<h3>glob<a class="headerlink" href="#glob" title="連結到這個標頭">¶</a></h3>
<p>在 <a class="reference internal" href="../library/glob.html#glob.glob" title="glob.glob"><code class="xref py py-func docutils literal notranslate"><span class="pre">glob()</span></code></a> 和 <a class="reference internal" href="../library/glob.html#glob.iglob" title="glob.iglob"><code class="xref py py-func docutils literal notranslate"><span class="pre">iglob()</span></code></a> 中新增 <em>root_dir</em> 和 <em>dir_fd</em> 參數，允許指定搜索的根目錄。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38144">bpo-38144</a> 中貢獻。）</p>
</section>
<section id="hashlib">
<h3>hashlib<a class="headerlink" href="#hashlib" title="連結到這個標頭">¶</a></h3>
<p>hashlib 模組需要 OpenSSL 1.1.1 或更高版本。（由 Christian Heimes 在 <span class="target" id="index-109"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43669">bpo-43669</a> 中貢獻。）</p>
<p>hashlib 模組初步支援 OpenSSL 3.0.0。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38820">bpo-38820</a> 和其他問題中貢獻。）</p>
<p>純 Python 的 <a class="reference internal" href="../library/hashlib.html#hashlib.pbkdf2_hmac" title="hashlib.pbkdf2_hmac"><code class="xref py py-func docutils literal notranslate"><span class="pre">pbkdf2_hmac()</span></code></a> 回退已被棄用。將來只有在有 OpenSSL 支援的建置 Python 中才能夠使用 PBKDF2-HMAC。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43880">bpo-43880</a> 中貢獻。）</p>
</section>
<section id="hmac">
<h3>hmac<a class="headerlink" href="#hmac" title="連結到這個標頭">¶</a></h3>
<p>hmac 模組現在在內部使用 OpenSSL 的 HMAC 實作。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40645">bpo-40645</a> 中貢獻。）</p>
</section>
<section id="idle-and-idlelib">
<h3>IDLE 和 idlelib<a class="headerlink" href="#idle-and-idlelib" title="連結到這個標頭">¶</a></h3>
<p>讓 IDLE 調用 <a class="reference internal" href="../library/sys.html#sys.excepthook" title="sys.excepthook"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.excepthook()</span></code></a> （在沒有 <code class="docutils literal notranslate"><span class="pre">-n</span></code> 的情況下啟動時）。使用者掛鉤 (user hooks) 在以前是被忽略的。（由 Ken Hilton 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43008">bpo-43008</a> 中貢獻。）</p>
<p>重新排列設定對話框。將 General 分頁拆分為 Windows 和 Shell/Ed 分頁。將擴充 Help 選單的幫助來源移至 Extensions 分頁。為新選項騰出空間並縮短對話框，而後者使對話框更好地適應較小的螢幕。（由 Terry Jan Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40468">bpo-40468</a> 中貢獻。）將縮排空間設定從 Font 分頁移至新的 Windows 分頁。（由 Mark Roseman 和 Terry Jan Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=33962">bpo-33962</a> 中貢獻。）</p>
<p>上述更改已向後移植到 3.9 維護版本。</p>
<p>新增 Shell 側邊欄。將主要提示字元 (<code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code>) 移至側邊欄。將輔助提示字元（<code class="docutils literal notranslate"><span class="pre">...</span></code>）新增到側邊欄。點擊左鍵再拖動能夠選擇一行或多行文字，和編輯器列號側邊欄操作一樣。選擇文字列後點擊右鍵會顯示帶有「一併複製提示字元 (copy with prompts)」的情境選單，這會將側邊欄中提示字元與所選文字並排，此選項也會出現在文字的情境選單上。（由 Tal Einat 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37903">bpo-37903</a> 中貢獻。）</p>
<p>使用空格而不是製表符號 (tab) 來縮進交互式程式碼。這能夠使交互式程式碼條目「看起來正確」。新增 shell 側邊欄的主要動機是實現這一點。（由 Terry Jan Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37892">bpo-37892</a> 中貢獻。）</p>
<p>突顯 (highlight) 模式匹配陳述式中的新<a class="reference internal" href="../reference/lexical_analysis.html#soft-keywords"><span class="std std-ref">軟關鍵字 (soft keywords)</span></a> <a class="reference internal" href="../reference/compound_stmts.html#match"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">match</span></code></a>、<a class="reference internal" href="../reference/compound_stmts.html#match"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">case</span></code></a> 和 <a class="reference internal" href="../reference/compound_stmts.html#wildcard-patterns"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">_</span></code></a>。然而這種突顯並不完美，並且在某些罕見的情況下會出錯，包括 <code class="docutils literal notranslate"><span class="pre">case</span></code> 模式中的一些 <code class="docutils literal notranslate"><span class="pre">_</span></code>。（由 Tal Einat 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44010">bpo-44010</a> 中貢獻。）</p>
<p>3.10 維護版本中的新增功能。</p>
<p>將語法突顯 (syntax highlighting) 應用於 <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> 檔案。（由 Alex Waygood 和 Terry Jan Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=45447">bpo-45447</a> 中貢獻。）</p>
<p>保存帶有輸入和輸出的 Shell 時，會包含提示字元。（由 Terry Jan Reedy 在 <a class="reference external" href="https://github.com/python/cpython/issues/95191">gh-95191</a> 中貢獻。）</p>
</section>
<section id="importlib-metadata">
<h3>importlib.metadata<a class="headerlink" href="#importlib-metadata" title="連結到這個標頭">¶</a></h3>
<p>與 <code class="docutils literal notranslate"><span class="pre">importlib_metadata</span></code> 4.6 功能相同（<a class="reference external" href="https://importlib-metadata.readthedocs.io/en/latest/history.html">歷史</a>）。</p>
<p><a class="reference internal" href="../library/importlib.metadata.html#entry-points"><span class="std std-ref">importlib.metadata 入口點</span></a>現在透過新的 <a class="reference internal" href="../library/importlib.metadata.html#entry-points"><span class="std std-ref">importlib.metadata.EntryPoints</span></a> 類別提供了以群組和名稱選擇入口點的更好體驗。有關棄用與用法的更多資訊，請參閱文件中的相容性說明。</p>
<p>新增了 <a class="reference internal" href="../library/importlib.metadata.html#package-distributions"><span class="std std-ref">importlib.metadata.packages_distributions()</span></a> 用於將頂階 Python 模組和套件解析出 <a class="reference internal" href="../library/importlib.metadata.html#distributions"><span class="std std-ref">importlib.metadata.Distribution</span></a>。</p>
</section>
<section id="inspect">
<h3>inspect<a class="headerlink" href="#inspect" title="連結到這個標頭">¶</a></h3>
<p>當模組未定義 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> 時，回退到 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中貢獻。）</p>
<p>新增 <a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a>，它可以安全地計算物件上定義的註釋。它是存取各種型別物件註釋的怪作法 (quirks) 的變通解法 (work around)，並且對其檢查的物件做出很少的假設。 <a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a> 也可以正確地取消字串化註釋 (stringized annotations)。 <a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a> 現在被認為是存取任何 Python 物件上定義的註釋字典的最佳實踐；有關使用註釋的最佳實踐的更多資訊，請參閱 <a class="reference internal" href="../howto/annotations.html#annotations-howto"><span class="std std-ref">註釋 (annotation) 最佳實踐</span></a>。相關地，<a class="reference internal" href="../library/inspect.html#inspect.signature" title="inspect.signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.signature()</span></code></a>、<a class="reference internal" href="../library/inspect.html#inspect.Signature.from_callable" title="inspect.Signature.from_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.Signature.from_callable()</span></code></a> 和 <code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.Signature.from_function()</span></code> 現在呼叫 <a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a> 來檢索註釋。這意味著 <a class="reference internal" href="../library/inspect.html#inspect.signature" title="inspect.signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.signature()</span></code></a> 和 <a class="reference internal" href="../library/inspect.html#inspect.Signature.from_callable" title="inspect.Signature.from_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.Signature.from_callable()</span></code></a> 現在也可以取消字串化註釋。（由 Larry Hastings 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43817">bpo-43817</a> 中貢獻。）</p>
</section>
<section id="itertools">
<h3>itertools<a class="headerlink" href="#itertools" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/itertools.html#itertools.pairwise" title="itertools.pairwise"><code class="xref py py-func docutils literal notranslate"><span class="pre">itertools.pairwise()</span></code></a>。（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38200">bpo-38200</a> 中貢獻。）</p>
</section>
<section id="linecache">
<h3>linecache<a class="headerlink" href="#linecache" title="連結到這個標頭">¶</a></h3>
<p>當模組未定義 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> 時，回退到 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中貢獻。）</p>
</section>
<section id="os">
<h3>os<a class="headerlink" href="#os" title="連結到這個標頭">¶</a></h3>
<p>為 VxWorks RTOS 新增 <a class="reference internal" href="../library/os.html#os.cpu_count" title="os.cpu_count"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.cpu_count()</span></code></a> 支援。（由 Peixing Xin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41440">bpo-41440</a> 中貢獻。）</p>
<p>新增函式 <a class="reference internal" href="../library/os.html#os.eventfd" title="os.eventfd"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.eventfd()</span></code></a> 和相關幫助程式來包裝 Linux 上的 <code class="docutils literal notranslate"><span class="pre">eventfd2</span></code> 系統呼叫。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41001">bpo-41001</a> 中貢獻。）</p>
<p>新增 <a class="reference internal" href="../library/os.html#os.splice" title="os.splice"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.splice()</span></code></a> 以允許在兩個檔案描述器 (file descriptor) 之間移動資料，而無需在核心地址空間 (kernel address space) 和使用者地址空間 (user address space) 之間進行複製，其中檔案描述器之一必須是個 pipe。（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41625">bpo-41625</a> 中貢獻。）</p>
<p>為 macOS 新增 <a class="reference internal" href="../library/os.html#os.O_EVTONLY" title="os.O_EVTONLY"><code class="xref py py-const docutils literal notranslate"><span class="pre">O_EVTONLY</span></code></a>、<a class="reference internal" href="../library/os.html#os.O_FSYNC" title="os.O_FSYNC"><code class="xref py py-const docutils literal notranslate"><span class="pre">O_FSYNC</span></code></a>、<a class="reference internal" href="../library/os.html#os.O_SYMLINK" title="os.O_SYMLINK"><code class="xref py py-const docutils literal notranslate"><span class="pre">O_SYMLINK</span></code></a> 和 <a class="reference internal" href="../library/os.html#os.O_NOFOLLOW_ANY" title="os.O_NOFOLLOW_ANY"><code class="xref py py-const docutils literal notranslate"><span class="pre">O_NOFOLLOW_ANY</span></code></a>。（由 Donghee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43106">bpo-43106</a> 中貢獻。）</p>
</section>
<section id="os-path">
<h3>os.path<a class="headerlink" href="#os-path" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/os.path.html#os.path.realpath" title="os.path.realpath"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.path.realpath()</span></code></a> 現在接受一個 <em>strict</em> 僅限關鍵字引數。當設定為 <code class="docutils literal notranslate"><span class="pre">True</span></code> 時，如果路徑不存在或遇到符號鏈接循環 (symlink loop)，則會引發 <a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a>。（由 Barney Gale 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43757">bpo-43757</a> 中貢獻。）</p>
</section>
<section id="pathlib">
<h3>pathlib<a class="headerlink" href="#pathlib" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/pathlib.html#pathlib.PurePath.parents" title="pathlib.PurePath.parents"><code class="xref py py-attr docutils literal notranslate"><span class="pre">PurePath.parents</span></code></a> 對於切片的支援。 （由 Joshua Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35498">bpo-35498</a> 中貢獻。）</p>
<p>向 <a class="reference internal" href="../library/pathlib.html#pathlib.PurePath.parents" title="pathlib.PurePath.parents"><code class="xref py py-attr docutils literal notranslate"><span class="pre">PurePath.parents</span></code></a> 新增負索引支援。（由 Yaroslav Pankovych 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=21041">bpo-21041</a> 中貢獻。）</p>
<p>新增替代 <code class="xref py py-meth docutils literal notranslate"><span class="pre">link_to()</span></code> 的 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.hardlink_to" title="pathlib.Path.hardlink_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Path.hardlink_to</span></code></a> 方法。新方法與 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.symlink_to" title="pathlib.Path.symlink_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">symlink_to()</span></code></a> 具有相同的引數順序。（由 Barney Gale 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39950">bpo-39950</a> 中貢獻。）</p>
<p><a class="reference internal" href="../library/pathlib.html#pathlib.Path.stat" title="pathlib.Path.stat"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.stat()</span></code></a> 和 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.chmod" title="pathlib.Path.chmod"><code class="xref py py-meth docutils literal notranslate"><span class="pre">chmod()</span></code></a> 現在接受 <em>follow_symlinks</em> 僅限關鍵字引數，以與 <a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> 模組中的相應函式保持一致。（由 Barney Gale 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39906">bpo-39906</a> 中貢獻。）</p>
</section>
<section id="platform">
<h3>platform<a class="headerlink" href="#platform" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/platform.html#platform.freedesktop_os_release" title="platform.freedesktop_os_release"><code class="xref py py-func docutils literal notranslate"><span class="pre">platform.freedesktop_os_release()</span></code></a> 以從 <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/os-release.html">freedesktop.org os-release</a> 標準檔案中檢索出作業系統標識。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=28468">bpo-28468</a> 中貢獻。）</p>
</section>
<section id="pprint">
<h3>pprint<a class="headerlink" href="#pprint" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/pprint.html#pprint.pprint" title="pprint.pprint"><code class="xref py py-func docutils literal notranslate"><span class="pre">pprint.pprint()</span></code></a> 現在接受新的 <code class="docutils literal notranslate"><span class="pre">underscore_numbers</span></code> 關鍵字引數。（由 sblondon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42914">bpo-42914</a> 中貢獻。）</p>
<p><a class="reference internal" href="../library/pprint.html#module-pprint" title="pprint: Data pretty printer."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pprint</span></code></a> 現在可以漂亮地印出 <a class="reference internal" href="../library/dataclasses.html#dataclasses.dataclass" title="dataclasses.dataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataclasses.dataclass</span></code></a> 實例。（由 Lewis Gaul 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43080">bpo-43080</a> 中貢獻。）</p>
</section>
<section id="py-compile">
<h3>py_compile<a class="headerlink" href="#py-compile" title="連結到這個標頭">¶</a></h3>
<p>將 <code class="docutils literal notranslate"><span class="pre">--quiet</span></code> 選項新增到 <a class="reference internal" href="../library/py_compile.html#module-py_compile" title="py_compile: Generate byte-code files from Python source files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">py_compile</span></code></a> 的命令列界面。（由 Gregory Schevchenko 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38731">bpo-38731</a> 中貢獻。）</p>
</section>
<section id="pyclbr">
<h3>pyclbr<a class="headerlink" href="#pyclbr" title="連結到這個標頭">¶</a></h3>
<p>將 <code class="docutils literal notranslate"><span class="pre">end_lineno</span></code> 屬性新增到 <a class="reference internal" href="../library/pyclbr.html#pyclbr.readmodule" title="pyclbr.readmodule"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyclbr.readmodule()</span></code></a> 和 <a class="reference internal" href="../library/pyclbr.html#pyclbr.readmodule_ex" title="pyclbr.readmodule_ex"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyclbr.readmodule_ex()</span></code></a> 回傳的樹中的 <code class="docutils literal notranslate"><span class="pre">Function</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Class</span></code> 物件。它與現有的（開始） <code class="docutils literal notranslate"><span class="pre">lineno</span></code> 匹配。（由 Aviral Srivastava 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38307">bpo-38307</a> 中貢獻。）</p>
</section>
<section id="shelve">
<h3>shelve<a class="headerlink" href="#shelve" title="連結到這個標頭">¶</a></h3>
<p>現在，<a class="reference internal" href="../library/shelve.html#module-shelve" title="shelve: Python object persistence."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shelve</span></code></a> 模組在建立 shelve 時預設使用 <a class="reference internal" href="../library/pickle.html#pickle.DEFAULT_PROTOCOL" title="pickle.DEFAULT_PROTOCOL"><code class="xref py py-const docutils literal notranslate"><span class="pre">pickle.DEFAULT_PROTOCOL</span></code></a>，而不是 <a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> 的協議 <code class="docutils literal notranslate"><span class="pre">3</span></code>。（由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34204">bpo-34204</a> 中貢獻。）</p>
</section>
<section id="statistics">
<h3>statistics<a class="headerlink" href="#statistics" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/statistics.html#statistics.covariance" title="statistics.covariance"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance()</span></code></a>、Pearson <a class="reference internal" href="../library/statistics.html#statistics.correlation" title="statistics.correlation"><code class="xref py py-func docutils literal notranslate"><span class="pre">correlation()</span></code></a> 和簡單 <a class="reference internal" href="../library/statistics.html#statistics.linear_regression" title="statistics.linear_regression"><code class="xref py py-func docutils literal notranslate"><span class="pre">linear_regression()</span></code></a> 函式。（由 Tymoteusz Wołodźko 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38490">bpo-38490</a> 中貢獻。）</p>
</section>
<section id="site">
<h3>site<a class="headerlink" href="#site" title="連結到這個標頭">¶</a></h3>
<p>當模組未定義 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> 時，回退到 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中貢獻。）</p>
</section>
<section id="socket">
<h3>socket<a class="headerlink" href="#socket" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/socket.html#socket.timeout" title="socket.timeout"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.timeout</span></code></a> 例外現在是 <a class="reference internal" href="../library/exceptions.html#TimeoutError" title="TimeoutError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TimeoutError</span></code></a> 的別名。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42413">bpo-42413</a> 中貢獻。）</p>
<p>新增使用 <code class="docutils literal notranslate"><span class="pre">IPPROTO_MPTCP</span></code> 建立 MPTCP socket 的選項（由 Rui Cunha 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43571">bpo-43571</a> 中貢獻。）</p>
<p>新增 <code class="docutils literal notranslate"><span class="pre">IP_RECVTOS</span></code> 選項以接收服務型別 (type of service, ToS) 或 DSCP/ECN 欄位（由 Georg Sauthoff 在 44077 中貢獻。）</p>
</section>
<section id="ssl">
<h3>ssl<a class="headerlink" href="#ssl" title="連結到這個標頭">¶</a></h3>
<p>ssl 模組需要 OpenSSL 1.1.1 或更高版本。（由 Christian Heimes 在 <span class="target" id="index-110"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43669">bpo-43669</a> 中貢獻。）</p>
<p>ssl 模組初步支援 OpenSSL 3.0.0 和新選項 <a class="reference internal" href="../library/ssl.html#ssl.OP_IGNORE_UNEXPECTED_EOF" title="ssl.OP_IGNORE_UNEXPECTED_EOF"><code class="xref py py-const docutils literal notranslate"><span class="pre">OP_IGNORE_UNEXPECTED_EOF</span></code></a>。（由 Christian Heimes 於 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38820">bpo-38820</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43794">bpo-43794</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43788">bpo-43788</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43791">bpo-43791</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43799">bpo-43799</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43920">bpo-43920</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43789">bpo-43789</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43811">bpo-43811</a> 貢獻。)</p>
<p>已棄用函式和使用已棄用常數現在會導致 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.options" title="ssl.SSLContext.options"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ssl.SSLContext.options</span></code></a> 預設設定有 <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv2" title="ssl.OP_NO_SSLv2"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv2</span></code></a> 和 <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv3" title="ssl.OP_NO_SSLv3"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv3</span></code></a>，因此無法再次發出設定該旗標的警告。<a class="reference internal" href="#whatsnew310-deprecated"><span class="std std-ref">棄用部分</span></a>包含已棄用功能的列表。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43880">bpo-43880</a> 中貢獻。）</p>
<p>ssl 模組現在具有更安全的預設設定。預設情況下禁用沒有前向保密或 SHA-1 MAC 的密碼。安全級別 2 禁止安全性低於 112 位元的弱 RSA、DH 和 ECC 密鑰。 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SSLContext</span></code></a> 預設為最低協議版本 TLS 1.2。設定基於 Hynek Schlawack 的研究。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43998">bpo-43998</a> 中貢獻。）</p>
<p>不再正式支援已棄用的協議 SSL 3.0、TLS 1.0 和 TLS 1.1。 Python 不會主動阻止它們。然而，OpenSSL 建置選項、發行版配置、發行商補丁和密碼套件可能會阻止交握的成功。</p>
<p>向 <a class="reference internal" href="../library/ssl.html#ssl.get_server_certificate" title="ssl.get_server_certificate"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.get_server_certificate()</span></code></a> 函式新增 <em>timeout</em> 參數。（由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31870">bpo-31870</a> 中貢獻。）</p>
<p>ssl 模組使用堆疊類型 (heap-types) 和多階段初始化 (multi-phase initialization)。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42333">bpo-42333</a> 中貢獻。）</p>
<p>新增驗證旗標 <a class="reference internal" href="../library/ssl.html#ssl.VERIFY_X509_PARTIAL_CHAIN" title="ssl.VERIFY_X509_PARTIAL_CHAIN"><code class="xref py py-const docutils literal notranslate"><span class="pre">VERIFY_X509_PARTIAL_CHAIN</span></code></a>。（由 l0x 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40849">bpo-40849</a> 中貢獻。）</p>
</section>
<section id="sqlite3">
<h3>sqlite3<a class="headerlink" href="#sqlite3" title="連結到這個標頭">¶</a></h3>
<p>新增 <code class="xref py py-func docutils literal notranslate"><span class="pre">connect/handle()</span></code>、<a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.enable_load_extension" title="sqlite3.Connection.enable_load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enable_load_extension()</span></code></a> 和 <a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.load_extension" title="sqlite3.Connection.load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_extension()</span></code></a> 的稽核事件。（由 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43762">bpo-43762</a> 中貢獻。）</p>
</section>
<section id="sys">
<h3>sys<a class="headerlink" href="#sys" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/sys.html#sys.orig_argv" title="sys.orig_argv"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.orig_argv</span></code></a> 屬性：傳遞給 Python 可執行檔案的原始命令列引數列表。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=23427">bpo-23427</a> 中貢獻。）</p>
<p>新增 <a class="reference internal" href="../library/sys.html#sys.stdlib_module_names" title="sys.stdlib_module_names"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdlib_module_names</span></code></a>，其中包含標準函式庫模組的名稱列表。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42955">bpo-42955</a> 中貢獻。）</p>
</section>
<section id="thread">
<h3>_thread<a class="headerlink" href="#thread" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/_thread.html#thread.interrupt_main" title="_thread.interrupt_main"><code class="xref py py-func docutils literal notranslate"><span class="pre">_thread.interrupt_main()</span></code></a> 現在需要一個可選的信號編號來進行模擬（預設值仍然是 <a class="reference internal" href="../library/signal.html#signal.SIGINT" title="signal.SIGINT"><code class="xref py py-const docutils literal notranslate"><span class="pre">signal.SIGINT</span></code></a>）。（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43356">bpo-43356</a> 中貢獻。）</p>
</section>
<section id="threading">
<h3>threading<a class="headerlink" href="#threading" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/threading.html#threading.gettrace" title="threading.gettrace"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.gettrace()</span></code></a> 和 <a class="reference internal" href="../library/threading.html#threading.getprofile" title="threading.getprofile"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.getprofile()</span></code></a> 分別取得 <a class="reference internal" href="../library/threading.html#threading.settrace" title="threading.settrace"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.settrace()</span></code></a> 和 <a class="reference internal" href="../library/threading.html#threading.setprofile" title="threading.setprofile"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.setprofile()</span></code></a> 設定的函式。（由 Mario Corchero 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42251">bpo-42251</a> 中貢獻。）</p>
<p>新增 <a class="reference internal" href="../library/threading.html#threading.__excepthook__" title="threading.__excepthook__"><code class="xref py py-data docutils literal notranslate"><span class="pre">threading.__excepthook__</span></code></a> 以允許取得 <a class="reference internal" href="../library/threading.html#threading.excepthook" title="threading.excepthook"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.excepthook()</span></code></a> 的原始值，以防它被設定為損壞或不同的值。（由 Mario Corchero 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42308">bpo-42308</a> 中貢獻。）</p>
</section>
<section id="traceback">
<h3>traceback<a class="headerlink" href="#traceback" title="連結到這個標頭">¶</a></h3>
<p><a class="reference internal" href="../library/traceback.html#traceback.format_exception" title="traceback.format_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception()</span></code></a>、<a class="reference internal" href="../library/traceback.html#traceback.format_exception_only" title="traceback.format_exception_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception_only()</span></code></a> 和 <a class="reference internal" href="../library/traceback.html#traceback.print_exception" title="traceback.print_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">print_exception()</span></code></a> 函式現在可以將例外物件作為僅限位置引數。（由 Zackery Spytz 和 Matthias Bussonnier 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26389">bpo-26389</a> 中貢獻。）</p>
</section>
<section id="types">
<h3>types<a class="headerlink" href="#types" title="連結到這個標頭">¶</a></h3>
<p>重新引入 <a class="reference internal" href="../library/types.html#types.EllipsisType" title="types.EllipsisType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.EllipsisType</span></code></a>、<a class="reference internal" href="../library/types.html#types.NoneType" title="types.NoneType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.NoneType</span></code></a> 和 <a class="reference internal" href="../library/types.html#types.NotImplementedType" title="types.NotImplementedType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.NotImplementedType</span></code></a> 類別，提供一組易於型別檢查器直譯的新型別。（由 Bas van Beek 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41810">bpo-41810</a> 中貢獻。）</p>
</section>
<section id="typing">
<h3>typing<a class="headerlink" href="#typing" title="連結到這個標頭">¶</a></h3>
<p>有關重大更改，請參閱<a class="reference internal" href="#new-feat-related-type-hints"><span class="std std-ref">與型別提示相關的新功能</span></a>。</p>
<p><a class="reference internal" href="../library/typing.html#typing.Literal" title="typing.Literal"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Literal</span></code></a> 的行為已更改為符合 <span class="target" id="index-111"></span><a class="pep reference external" href="https://peps.python.org/pep-0586/"><strong>PEP 586</strong></a> 並匹配 PEP 中指定的靜態型別檢查器的行為。</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 現在可以刪除重複參數。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 物件之間的相等性比較現在與順序無關。</p></li>
<li><p>現在型別的比較會優先於 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 的比較。例如，<code class="docutils literal notranslate"><span class="pre">Literal[0]</span> <span class="pre">==</span> <span class="pre">Literal[False]</span></code> 先前之求值為 <code class="docutils literal notranslate"><span class="pre">True</span></code>，但現在它是 <code class="docutils literal notranslate"><span class="pre">False</span></code>。為了支援此更改，內部使用的型別快取現在支援了型別的辨認。</p></li>
<li><p>如果 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 物件的任ㄧ參數不是<a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">可雜湊的</span></a>，那麼它們現在將在相等性比較期間引發 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> 例外。請注意，使用不可雜湊的參數宣告 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 不會引發錯誤：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Literal</span><span class="p">[{</span><span class="mi">0</span><span class="p">}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Literal</span><span class="p">[{</span><span class="mi">0</span><span class="p">}]</span> <span class="o">==</span> <span class="n">Literal</span><span class="p">[{</span><span class="kc">False</span><span class="p">}]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">unhashable type: &#39;set&#39;</span>
</pre></div>
</div>
</li>
</ol>
<p>（由 Yurii Karabas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42345">bpo-42345</a> 中貢獻。）</p>
<p>新增函式 <a class="reference internal" href="../library/typing.html#typing.is_typeddict" title="typing.is_typeddict"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.is_typeddict()</span></code></a> 來自我審查 (introspect) 註釋是否為 <a class="reference internal" href="../library/typing.html#typing.TypedDict" title="typing.TypedDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.TypedDict</span></code></a>。（由 Patrick Reader 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41792">bpo-41792</a> 中貢獻。）</p>
<p>僅宣告了資料變數的 <code class="docutils literal notranslate"><span class="pre">typing.Protocol</span></code> 子類別現在在使用 <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> 檢查時會引發 <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> ，除非它們用 <a class="reference internal" href="../library/typing.html#typing.runtime_checkable" title="typing.runtime_checkable"><code class="xref py py-func docutils literal notranslate"><span class="pre">runtime_checkable()</span></code></a> 裝飾。此前，這些檢查都是悄無聲息地通過的。如果使用者需要執行環境協議 (runtime protocol)，則應該使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">runtime_checkable()</span></code> 裝飾器來裝飾其子類別。（由 Yurii Karabas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38908">bpo-38908</a> 中貢獻。）</p>
<p>從 <code class="docutils literal notranslate"><span class="pre">typing.io</span></code> 和 <code class="docutils literal notranslate"><span class="pre">typing.re</span></code> 子模組引入現在將發出 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。這些子模組自 Python 3.8 起已被棄用，並將在未來版本的 Python 中刪除。屬於這些子模組的任何內容都應該直接從 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 引入。 （由 Sebastian Rittau 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38291">bpo-38291</a> 中貢獻。）</p>
</section>
<section id="unittest">
<h3>unittest<a class="headerlink" href="#unittest" title="連結到這個標頭">¶</a></h3>
<p>新增方法 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNoLogs" title="unittest.TestCase.assertNoLogs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNoLogs()</span></code></a> 以補足現有的 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertLogs" title="unittest.TestCase.assertLogs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertLogs()</span></code></a>。（由 Kit Yan Choi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39385">bpo-39385</a> 中貢獻。）</p>
</section>
<section id="urllib-parse">
<h3>urllib.parse<a class="headerlink" href="#urllib-parse" title="連結到這個標頭">¶</a></h3>
<p>Python 3.10 之前的 Python 版本允許在 <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qs()</span></code></a> 和 <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.parse_qsl" title="urllib.parse.parse_qsl"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qsl()</span></code></a> 中使用 <code class="docutils literal notranslate"><span class="pre">;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> 作為查詢參數 (query parameter) 的分隔符號。出於安全考慮，並且為了符合更新的 W3C 建議，已將其更改為僅允許單個分隔符號鍵，預設為 <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>。此更改還會影響 <a class="reference internal" href="../library/cgi.html#cgi.parse" title="cgi.parse"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgi.parse()</span></code></a> 和 <a class="reference internal" href="../library/cgi.html#cgi.parse_multipart" title="cgi.parse_multipart"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgi.parse_multipart()</span></code></a>，因為它們在內部使用受影響的函式。有關更多詳細資訊，請參閱各自的文件。（由 Adam Goldschmidt、Senthil Kumaran 和 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42967">bpo-42967</a> 中貢獻。）</p>
<p>The presence of newline or tab characters in parts of a URL allows for some
forms of attacks. Following the WHATWG specification that updates <span class="target" id="index-32"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc3986.html"><strong>RFC 3986</strong></a>,
ASCII newline <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">\r</span></code> and tab <code class="docutils literal notranslate"><span class="pre">\t</span></code> characters are stripped from the
URL by the parser in <a class="reference internal" href="../library/urllib.parse.html#module-urllib.parse" title="urllib.parse: Parse URLs into or assemble them from components."><code class="xref py py-mod docutils literal notranslate"><span class="pre">urllib.parse</span></code></a> preventing such attacks. The removal
characters are controlled by a new module level variable
<code class="docutils literal notranslate"><span class="pre">urllib.parse._UNSAFE_URL_BYTES_TO_REMOVE</span></code>. (See <a class="reference external" href="https://github.com/python/cpython/issues/88048">gh-88048</a>)</p>
</section>
<section id="xml">
<h3>xml<a class="headerlink" href="#xml" title="連結到這個標頭">¶</a></h3>
<p>新增 <a class="reference internal" href="../library/xml.sax.handler.html#xml.sax.handler.LexicalHandler" title="xml.sax.handler.LexicalHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">LexicalHandler</span></code></a> 類別到 <a class="reference internal" href="../library/xml.sax.handler.html#module-xml.sax.handler" title="xml.sax.handler: Base classes for SAX event handlers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.sax.handler</span></code></a> 模組。（由 Jonathan Gossage 和 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35018">bpo-35018</a> 中貢獻。）</p>
</section>
<section id="zipimport">
<h3>zipimport<a class="headerlink" href="#zipimport" title="連結到這個標頭">¶</a></h3>
<p>新增與 <span class="target" id="index-112"></span><a class="pep reference external" href="https://peps.python.org/pep-0451/"><strong>PEP 451</strong></a> 相關的方法：<a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.find_spec" title="zipimport.zipimporter.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_spec()</span></code></a>、<a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.create_module" title="zipimport.zipimporter.create_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">zipimport.zipimporter.create_module()</span></code></a> 和 <a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.exec_module" title="zipimport.zipimporter.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">zipimport.zipimporter.exec_module()</span></code></a>。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42131">bpo-42131</a> 中貢獻。）</p>
<p>新增 <a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.invalidate_caches" title="zipimport.zipimporter.invalidate_caches"><code class="xref py py-meth docutils literal notranslate"><span class="pre">invalidate_caches()</span></code></a> 方法。（由 Desmond Cheong 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=14678">bpo-14678</a> 中貢獻。）</p>
</section>
</section>
<section id="optimizations">
<h2>最佳化<a class="headerlink" href="#optimizations" title="連結到這個標頭">¶</a></h2>
<ul class="simple">
<li><p>建構函式 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a>、<a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">bytes()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-func docutils literal notranslate"><span class="pre">bytearray()</span></code></a> 現在更快了（對於小型物件大約快了 30--40%）。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41334">bpo-41334</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/runpy.html#module-runpy" title="runpy: Locate and run Python modules without importing them first."><code class="xref py py-mod docutils literal notranslate"><span class="pre">runpy</span></code></a> 模組現在引入更少的模組。<code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">module-name</span></code> 指令啟動時間平均快了 1.4 倍。在 Linux 上，<code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-I</span> <span class="pre">-m</span> <span class="pre">module-name</span></code> 在 Python 3.9 上引入 69 個模組，而在 Python 3.10 上僅引入 51 個模組 (-18)。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41006">bpo-41006</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41718">bpo-41718</a> 中貢獻。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOAD_ATTR</span></code> 指令現在使用新的「操作碼快取 (per opcode cache)」機制。現在一般屬性的速度提高了約 36%，槽位 (slot) 的速度提高了 44%。（由 Pablo Galindo 和 Yury Selivanov 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42093">bpo-42093</a> 中以及 Guido van Rossum 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42927">bpo-42927</a> 中貢獻，基於最初在 PyPy 和 MicroPython 中實作的想法。）</p></li>
<li><p>當使用 <a class="reference internal" href="../using/configure.html#cmdoption-enable-optimizations"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-optimizations</span></code></a> 建置 Python 時，現在 <code class="docutils literal notranslate"><span class="pre">-fno-semantic-interposition</span></code> 被新增到編譯和鏈接列 (link line) 中。這使得使用 <a class="reference internal" href="../using/configure.html#cmdoption-enable-shared"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-shared</span></code></a> 和 <code class="docutils literal notranslate"><span class="pre">gcc</span></code> 建立的 Python 直譯器的建置速度提高了 30%。請參閱<a class="reference external" href="https://developers.redhat.com/blog/2020/06/25/red-hat-enterprise-linux-8-2-brings-faster-python-3-8-run-speeds/">本文</a> 以了解詳情。（由 Victor Stinner 和 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38980">bpo-38980</a> 中貢獻。）</p></li>
<li><p>對 <a class="reference internal" href="../library/bz2.html#module-bz2" title="bz2: Interfaces for bzip2 compression and decompression."><code class="xref py py-mod docutils literal notranslate"><span class="pre">bz2</span></code></a> / <a class="reference internal" href="../library/lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> / <a class="reference internal" href="../library/zlib.html#module-zlib" title="zlib: Low-level interface to compression and decompression routines compatible with gzip."><code class="xref py py-mod docutils literal notranslate"><span class="pre">zlib</span></code></a> 模組使用新的輸出緩衝區管理程式碼，並將 <code class="docutils literal notranslate"><span class="pre">.readall()</span></code> 函式新增到 <code class="docutils literal notranslate"><span class="pre">_compression.DecompressReader</span></code> 類別。 bz2 解壓縮速度提高了 1.09x ~ 1.17x，lzma 解壓縮速度提高了 1.20x ~ 1.32x，<code class="docutils literal notranslate"><span class="pre">GzipFile.read(-1)</span></code> 速度提高了 1.11x ~ 1.18x。（由 Ma Lin 於 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41486">bpo-41486</a> 貢獻、由 Gregory P. Smith 審閱）</p></li>
<li><p>使用字串化註釋時，建立函式時不再建立函式的註釋字典。取而代之的是它們被存儲為字串元組，且函式物件會根據需求才將其延遲轉換 (lazily convert) 為註釋字典。此最佳化將定義帶有註釋的函式所需的 CPU 時間減少了一半。（由 Yurii Karabas 和 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42202">bpo-42202</a> 中貢獻。）</p></li>
<li><p>像是 <code class="docutils literal notranslate"><span class="pre">str1</span> <span class="pre">in</span> <span class="pre">str2</span></code> 和 <code class="docutils literal notranslate"><span class="pre">str2.find(str1)</span></code> 之類的子字串搜索函式現在有時會使用 Crochemore &amp; Perrin 的「雙向」字串搜索演算法來避免作用於長字串上時發生二次方行為 (quadratic behavior)。（由 Dennis Sweeney 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41972">bpo-41972</a> 中貢獻）</p></li>
<li><p>向 <code class="docutils literal notranslate"><span class="pre">_PyType_Lookup()</span></code> 新增微最佳化以提高快取命中的常見情況下的型別屬性快取查找性能。這使得直譯器平均速度提高了 1.04 倍。（由 Dino Viehland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43452">bpo-43452</a> 中貢獻。）</p></li>
<li><p>以下內建函式現在支援更快的 <span class="target" id="index-113"></span><a class="pep reference external" href="https://peps.python.org/pep-0590/"><strong>PEP 590</strong></a> vectorcall 呼叫慣例：<a class="reference internal" href="../library/functions.html#map" title="map"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a>、<a class="reference internal" href="../library/functions.html#filter" title="filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">filter()</span></code></a>、<a class="reference internal" href="../library/functions.html#reversed" title="reversed"><code class="xref py py-func docutils literal notranslate"><span class="pre">reversed()</span></code></a>、<a class="reference internal" href="../library/functions.html#bool" title="bool"><code class="xref py py-func docutils literal notranslate"><span class="pre">bool()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-func docutils literal notranslate"><span class="pre">float()</span></code></a>。（由 Donghee Na 和 Jeroen Demeyer 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43575">bpo-43575</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43287">bpo-43287</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41922">bpo-41922</a>、<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41873">bpo-41873</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41870">bpo-41870</a> 中貢獻。）</p></li>
<li><p>通過刪除內部 <code class="docutils literal notranslate"><span class="pre">RLock</span></code>，<a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal notranslate"><span class="pre">BZ2File</span></code></a> 的性能得到了改進。這使得 <code class="xref py py-class docutils literal notranslate"><span class="pre">BZ2File</span></code> 在面對多個同時的讀取器或寫入器時執行緒不安全，就像 <a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a> 和 <a class="reference internal" href="../library/lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> 中的等效類別一樣。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43785">bpo-43785</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="deprecated">
<span id="whatsnew310-deprecated"></span><h2>已棄用<a class="headerlink" href="#deprecated" title="連結到這個標頭">¶</a></h2>
<ul>
<li><p>目前 Python 接受緊跟關鍵字的數字字面值 (numeric literals)，例如 <code class="docutils literal notranslate"><span class="pre">0in</span> <span class="pre">x</span></code>、<code class="docutils literal notranslate"><span class="pre">1or</span> <span class="pre">x</span></code>、<code class="docutils literal notranslate"><span class="pre">0if</span> <span class="pre">1else</span> <span class="pre">2</span></code>。它允許了令人困惑和不明確的運算式，例如 <code class="docutils literal notranslate"><span class="pre">[0x1for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code> （可以直譯為 <code class="docutils literal notranslate"><span class="pre">[0x1</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code> 或 <code class="docutils literal notranslate"><span class="pre">[0x1f</span> <span class="pre">or</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code> ）。從此版本開始，如果數字字面值後緊跟關鍵字 <a class="reference internal" href="../reference/expressions.html#and"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">and</span></code></a>、<a class="reference internal" href="../reference/compound_stmts.html#else"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">else</span></code></a>、<a class="reference internal" href="../reference/compound_stmts.html#for"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">for</span></code></a>、<a class="reference internal" href="../reference/compound_stmts.html#if"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">if</span></code></a>、<a class="reference internal" href="../reference/expressions.html#in"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">in</span></code></a>、<a class="reference internal" href="../reference/expressions.html#is"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">is</span></code></a> 與 <a class="reference internal" href="../reference/expressions.html#or"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">or</span></code></a> 其中之一，則會引發棄用警告。在未來的版本中，它將被變更為語法警告，最後成為為語法錯誤。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43833">bpo-43833</a> 中貢獻。）</p></li>
<li><p>從這個版本開始，我們將齊心協力開始清理為相容 Python 2.7 而保留的舊引入語義。具體來說， <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_loader()</span></code>/<code class="xref py py-meth docutils literal notranslate"><span class="pre">find_module()</span></code> （被 <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder.find_spec" title="importlib.abc.MetaPathFinder.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_spec()</span></code></a> 取代）、<a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.load_module" title="importlib.abc.Loader.load_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_module()</span></code></a> （被 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.exec_module" title="importlib.abc.Loader.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a> 取代）、 <code class="xref py py-meth docutils literal notranslate"><span class="pre">module_repr()</span></code> （引入系統負責處理你）、<code class="docutils literal notranslate"><span class="pre">__package__</span></code> 屬性（由 <code class="docutils literal notranslate"><span class="pre">__spec__.parent</span></code> 取代）、 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> 屬性（由 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 取代）和 <code class="docutils literal notranslate"><span class="pre">__cached__</span></code> 屬性（由 <code class="docutils literal notranslate"><span class="pre">__spec__.cached</span></code> 取代）將慢慢被刪除（以及 <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> 中的其他類別和方法）。將酌情引發 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a> 和/或 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 以幫助識別在此轉換期間需要更新的程式碼。</p></li>
<li><p>整個 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 命名空間已棄用，將在 Python 3.12 中刪除。請參閱<a class="reference internal" href="#distutils-deprecated"><span class="std std-ref">模組更改</span></a> 以獲取更多資訊。</p></li>
<li><p><a class="reference internal" href="../library/random.html#random.randrange" title="random.randrange"><code class="xref py py-func docutils literal notranslate"><span class="pre">random.randrange()</span></code></a> 的非整數引數已棄用。<a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> 已被棄用，取而代之的是 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。（由 Serhiy Storchaka 和 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37319">bpo-37319</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> 的各種 <code class="docutils literal notranslate"><span class="pre">load_module()</span></code> 方法自 Python 3.6 起已被記錄為已棄用，但現在也會觸發 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。請改用 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.exec_module" title="importlib.abc.Loader.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a>。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26131">bpo-26131</a> 中貢獻。）</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">zimport.zipimporter.load_module()</span></code> 已被棄用，請用 <a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.exec_module" title="zipimport.zipimporter.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a>。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26131">bpo-26131</a> 中貢獻。）</p></li>
<li><p>引入系統使用 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.load_module" title="importlib.abc.Loader.load_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_module()</span></code></a> 現在會觸發 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a>，因為 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.exec_module" title="importlib.abc.Loader.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a> 是當前首選。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26131">bpo-26131</a> 中貢獻。）</p></li>
<li><p>引入系統使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_module()</span></code> 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_module()</span></code> 現在會觸發 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a>，因為 <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder.find_spec" title="importlib.abc.MetaPathFinder.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_spec()</span></code></a> 和 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_spec" title="importlib.abc.PathEntryFinder.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_spec()</span></code></a> 分別是替代方案的首選。你可以使用 <a class="reference internal" href="../library/importlib.html#importlib.util.spec_from_loader" title="importlib.util.spec_from_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.spec_from_loader()</span></code></a> 來幫助移植。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42134">bpo-42134</a> 中貢獻。）</p></li>
<li><p>引入系統使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_loader()</span></code> 現在會觸發 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a>，因為 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_spec" title="importlib.abc.PathEntryFinder.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_spec()</span></code></a> 是首選。你可以使用 <a class="reference internal" href="../library/importlib.html#importlib.util.spec_from_loader" title="importlib.util.spec_from_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.spec_from_loader()</span></code></a> 來幫助移植。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43672">bpo-43672</a> 中貢獻。）</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_module()</span></code> 的各種實作（<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.BuiltinImporter.find_module()</span></code>、<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FrozenImporter.find_module()</span></code>、<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.WindowsRegistryFinder.find_module()</span></code>、<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.PathFinder.find_module()</span></code>、<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_module()</span></code> )、<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_module()</span></code> (<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FileFinder.find_module()</span></code> ) 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_loader()</span></code> (<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FileFinder.find_loader()</span></code> ) 現在引發 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 並計劃在 Python 3.12 中刪除（之前它們已在 Python 3.4 中被記錄為已棄用）。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42135">bpo-42135</a> 中貢獻。）</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.Finder</span></code> 已被棄用（包括其唯一方法 <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_module()</span></code>）。<a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder" title="importlib.abc.MetaPathFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder</span></code></a> 和 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder" title="importlib.abc.PathEntryFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder</span></code></a> 都不再從該類別繼承。使用者應該根據需求來選擇其一以繼承。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42135">bpo-42135</a> 中貢獻。）</p></li>
<li><p>棄用 <code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code>、<code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.find_loader()</span></code>、<code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.set_package_wrapper()</span></code>、<code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.set_loader_wrapper()</span></code>、<code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.module_for_loader()</span></code>、<code class="xref py py-class docutils literal notranslate"><span class="pre">pkgutil.ImpImporter</span></code> 和 <code class="xref py py-class docutils literal notranslate"><span class="pre">pkgutil.ImpLoader</span></code> 均已更新，將於 Python 3.12 列為預定的刪除版本（它們開始在過去版本的 Python 中引發 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>） 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43720">bpo-43720</a> 中貢獻。）</p></li>
<li><p>引入系統現在在模組上使用 <code class="docutils literal notranslate"><span class="pre">__spec__</span></code> 屬性，然後才會回退使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">module_repr()</span></code> 作為模組的 <code class="docutils literal notranslate"><span class="pre">__repr__()</span></code> 方法。計劃在 Python 3.12 中刪除 <code class="docutils literal notranslate"><span class="pre">module_repr()</span></code> 的使用。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42137">bpo-42137</a> 中貢獻。）</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.Loader.module_repr()</span></code>、<code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FrozenLoader.module_repr()</span></code> 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.BuiltinLoader.module_repr()</span></code> 已棄用並計劃在 Python 3.12 中刪除。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42136">bpo-42136</a> 中貢獻。）</p></li>
<li><p>自 Python 3.3 起，<code class="docutils literal notranslate"><span class="pre">sqlite3.OptimizedUnicode</span></code> 就沒有文件記錄並且已過時，當時它被用作 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 的別名。它現已被棄用，並計劃在 Python 3.12 中刪除。（由 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42264">bpo-42264</a> 中貢獻。）</p></li>
<li><p>未記錄於說明文件的內建函式 <code class="docutils literal notranslate"><span class="pre">sqlite3.enable_shared_cache</span></code> 現已棄用，計劃在 Python 3.12 中刪除。SQLite3 文件強烈建議不去使用它。有關更多詳細資訊，請參閱 <a class="reference external" href="https://sqlite.org/c3ref/enable_shared_cache.html">SQLite3 文件</a>。如果必須使用共享快取，請使用 <code class="docutils literal notranslate"><span class="pre">cache=shared</span></code> 查詢參數以 URI 模式打開資料庫。（由 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=24464">bpo-24464</a> 中貢獻。）</p></li>
<li><p>以下 <code class="docutils literal notranslate"><span class="pre">threading</span></code> 方法現已棄用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">threading.currentThread</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.current_thread" title="threading.current_thread"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.current_thread()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.activeCount</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.active_count" title="threading.active_count"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.active_count()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Condition.notifyAll</span></code> =&gt;
<a class="reference internal" href="../library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Condition.notify_all()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Event.isSet</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Event.is_set" title="threading.Event.is_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Event.is_set()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Thread.setName</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.name" title="threading.Thread.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.name</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.thread.getName</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.name" title="threading.Thread.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.name</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Thread.isDaemon</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.daemon" title="threading.Thread.daemon"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.daemon</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Thread.setDaemon</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.daemon" title="threading.Thread.daemon"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.daemon</span></code></a></p></li>
</ul>
<p>（由 Jelle Zijlstra 在 <a class="reference external" href="https://github.com/python/cpython/issues/87889">gh-87889</a> 中貢獻。）</p>
</li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.link_to()</span></code> 已棄用並計劃在 Python 3.12 中刪除。請改用 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.hardlink_to" title="pathlib.Path.hardlink_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.hardlink_to()</span></code></a>。（由 Barney Gale 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39950">bpo-39950</a> 中貢獻。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cgi.log()</span></code> 已棄用並計劃在 Python 3.12 中刪除。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41139">bpo-41139</a> 中貢獻。）</p></li>
<li><p>自 Python 3.6、Python 3.7 或 OpenSSL 1.1.0 起，以下 <a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> 功能已被棄用，並將在 3.11 中刪除：</p>
<ul class="simple">
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv2</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv3</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1_1</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1_2</span></code>、和 <code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1_3</span></code> 已被替換為 <code class="xref py py-attr docutils literal notranslate"><span class="pre">minimum_version</span></code> 和 <code class="xref py py-attr docutils literal notranslate"><span class="pre">maximum_version</span></code>。</p></li>
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_SSLv2</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_SSLv3</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_SSLv23</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLSv1</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLSv1_1</span></code>、<code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLSv1_2</span></code> 和 <code class="xref py py-const docutils literal notranslate"><span class="pre">PROTOCOL_TLS</span></code> 已棄用，取而代之的是 <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLS_CLIENT" title="ssl.PROTOCOL_TLS_CLIENT"><code class="xref py py-const docutils literal notranslate"><span class="pre">PROTOCOL_TLS_CLIENT</span></code></a> 和 <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLS_SERVER" title="ssl.PROTOCOL_TLS_SERVER"><code class="xref py py-const docutils literal notranslate"><span class="pre">PROTOCOL_TLS_SERVER</span></code></a></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap_socket()</span></code> 被替換為 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.wrap_socket()</span></code></a></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">match_hostname()</span></code></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">RAND_pseudo_bytes()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">RAND_egd()</span></code></p></li>
<li><p>NPN 功能如 <a class="reference internal" href="../library/ssl.html#ssl.SSLSocket.selected_npn_protocol" title="ssl.SSLSocket.selected_npn_protocol"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLSocket.selected_npn_protocol()</span></code></a> 和 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.set_npn_protocols" title="ssl.SSLContext.set_npn_protocols"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.set_npn_protocols()</span></code></a> 已被 ALPN 取代。</p></li>
</ul>
</li>
<li><p>執行緒除錯（<code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONTHREADDEBUG</span></code> 環境變數）在 Python 3.10 中已棄用，並將在 Python 3.12 中刪除。此功能需要一個 <a class="reference internal" href="../using/configure.html#debug-build"><span class="std std-ref">Python 的除錯用建置版本</span></a>。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44584">bpo-44584</a> 中貢獻。）</p></li>
<li><p>從 <code class="docutils literal notranslate"><span class="pre">typing.io</span></code> 和 <code class="docutils literal notranslate"><span class="pre">typing.re</span></code> 子模組引入現在將發出 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。這些子模組將在 Python 的未來版本中刪除。屬於這些子模組的任何內容都應該直接從 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 引入。（由 Sebastian Rittau 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38291">bpo-38291</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="removed">
<span id="whatsnew310-removed"></span><h2>已刪除<a class="headerlink" href="#removed" title="連結到這個標頭">¶</a></h2>
<ul>
<li><p>刪除了 <a class="reference internal" href="../library/functions.html#complex" title="complex"><code class="xref py py-class docutils literal notranslate"><span class="pre">complex</span></code></a> 類別的特殊方法 <code class="docutils literal notranslate"><span class="pre">__int__</span></code>、<code class="docutils literal notranslate"><span class="pre">__float__</span></code>、<code class="docutils literal notranslate"><span class="pre">__floordiv__</span></code>、<code class="docutils literal notranslate"><span class="pre">__mod__</span></code>、<code class="docutils literal notranslate"><span class="pre">__divmod__</span></code>、<code class="docutils literal notranslate"><span class="pre">__rfloordiv__</span></code>、<code class="docutils literal notranslate"><span class="pre">__rmod__</span></code> 和 <code class="docutils literal notranslate"><span class="pre">__rdivmod__</span></code> 。它們都會引發 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41974">bpo-41974</a> 中貢獻。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_markupbase</span></code> 模組中私有、未於文件記錄的 <code class="docutils literal notranslate"><span class="pre">ParserBase.error()</span></code> 方法已被刪除。<a class="reference internal" href="../library/html.parser.html#html.parser.HTMLParser" title="html.parser.HTMLParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">html.parser.HTMLParser</span></code></a> 是 <code class="docutils literal notranslate"><span class="pre">ParserBase</span></code> 的唯一子類別，它的 <code class="docutils literal notranslate"><span class="pre">error()</span></code> 實作已在 Python 3.5 中刪除。（由 Berker Peksag 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31844">bpo-31844</a> 中貢獻。）</p></li>
<li><p>刪除了 <code class="docutils literal notranslate"><span class="pre">unicodedata.ucnhash_CAPI</span></code> 屬性，該屬性是內部 PyCapsule 物件。相關的私有 <code class="docutils literal notranslate"><span class="pre">_PyUnicode_Name_CAPI</span></code> 結構已移至內部 C API。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42157">bpo-42157</a> 中貢獻。）</p></li>
<li><p>刪除了由於切換到新的 PEG 剖析器而在 3.9 中被棄用的 <code class="docutils literal notranslate"><span class="pre">parser</span></code> 模組。僅由舊剖析器使用的所有 C 原始碼和標頭檔也已被刪除，包括 <code class="docutils literal notranslate"><span class="pre">node.h</span></code>、<code class="docutils literal notranslate"><span class="pre">parser.h</span></code>、<code class="docutils literal notranslate"><span class="pre">graminit.h</span></code> 和 <code class="docutils literal notranslate"><span class="pre">grammar.h</span></code>。</p></li>
<li><p>刪除了公開 C API 函式 <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlags</span></code>、<code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlagsFilename</span></code>、<code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseFileFlags</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyNode_Compile</span></code>，這些函式由於切換到新的 PEG 剖析器而在 3.9 中被棄用。</p></li>
<li><p>刪除了 <code class="docutils literal notranslate"><span class="pre">formatter</span></code> 模組，該模組在 Python 3.4 中已棄用。它有些過時、很少被使用，也沒有經過測試。它最初計劃在 Python 3.6 中刪除，但此類別的刪除被推遲到 Python 2.7 EOL 之後。現有使用者應該將他們使用的任何類別複製到他們的程式碼中。（由 Donghee Na 和 Terry J. Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42299">bpo-42299</a> 中貢獻。）</p></li>
<li><p>刪除了 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetWarningsModule()</span></code> 函式，該函式現在無用，因為 <code class="xref py py-mod docutils literal notranslate"><span class="pre">_warnings</span></code> 模組在 2.6 中已轉換為內建模組。（由 Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42599">bpo-42599</a> 中貢獻。）</p></li>
<li><p>從 <a class="reference internal" href="../library/collections.html#module-collections" title="collections: Container datatypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections</span></code></a> 模組中刪除已棄用的、對 <a class="reference internal" href="../library/collections.abc.html#collections-abstract-base-classes"><span class="std std-ref">Collections Abstract Base Classes</span></a> 的別名。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37324">bpo-37324</a> 中貢獻。）</p></li>
<li><p>在 Python 3.8 中棄用後，<code class="docutils literal notranslate"><span class="pre">loop</span></code> 參數已從大多數 <a class="reference internal" href="../library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 的<a class="reference internal" href="../library/asyncio-api-index.html"><span class="doc">高階 API</span></a> 中刪除。這一變化的背後動機是多方面的：</p>
<ol class="arabic simple">
<li><p>這簡化了高階 API。</p></li>
<li><p>自 Python 3.7 以來，高階 API 中的函式一直隱式獲取當前執行緒正在運行的事件循環。在大多數正常用例中，不需要將事件循環傳遞給 API。</p></li>
<li><p>事件循環的傳遞很容易出錯，尤其是在處理在不同執行緒中運行的循環時。</p></li>
</ol>
<p>請注意，低階 API 仍會接受 <code class="docutils literal notranslate"><span class="pre">loop</span></code>。有關如何替換現有程式碼的範例，請參閱 <a class="reference internal" href="#changes-python-api"><span class="std std-ref">Python API 的變化</span></a>。</p>
<p>（由 Yurii Karabas、Andrew Svetlov、Yury Selivanov 和 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42392">bpo-42392</a> 中貢獻。）</p>
</li>
</ul>
</section>
<section id="porting-to-python-3-10">
<h2>移植到 Python 3.10<a class="headerlink" href="#porting-to-python-3-10" title="連結到這個標頭">¶</a></h2>
<p>本節列出了前面描述的更改以及可能需要更改程式碼的其他錯誤修復。</p>
<section id="changes-in-the-python-syntax">
<h3>Python 語法的變化<a class="headerlink" href="#changes-in-the-python-syntax" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>如果數字字面值後面緊跟關鍵字（如 <code class="docutils literal notranslate"><span class="pre">0in</span> <span class="pre">x</span></code>），在以前是有效的語法，但現在在編譯時會發出棄用警告。在未來的版本中，它將更改為語法警告，最後更改為語法錯誤。要消除警告並使程式碼與未來版本相容，只需在數字字面值和以下關鍵字之間新增一個空格即可。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43833">bpo-43833</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="changes-in-the-python-api">
<span id="changes-python-api"></span><h3>Python API 的變化<a class="headerlink" href="#changes-in-the-python-api" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../library/traceback.html#traceback.format_exception" title="traceback.format_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception()</span></code></a>、<a class="reference internal" href="../library/traceback.html#traceback.format_exception_only" title="traceback.format_exception_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception_only()</span></code></a> 和 <a class="reference internal" href="../library/traceback.html#module-traceback" title="traceback: Print or retrieve a stack traceback."><code class="xref py py-mod docutils literal notranslate"><span class="pre">traceback</span></code></a> 模組中的 <a class="reference internal" href="../library/traceback.html#traceback.print_exception" title="traceback.print_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">print_exception()</span></code></a> 函式的 <em>etype</em> 參數已重命名為 <em>exc</em>。（由 Zackery Spytz 和 Matthias Bussonnier 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26389">bpo-26389</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/atexit.html#module-atexit" title="atexit: Register and execute cleanup functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">atexit</span></code></a>：在 Python 退出時，如果一個使用 <a class="reference internal" href="../library/atexit.html#atexit.register" title="atexit.register"><code class="xref py py-func docutils literal notranslate"><span class="pre">atexit.register()</span></code></a> 註冊的回呼 (callback) 失敗，該例外現在會被記錄下來。在以前只記錄一些例外，並且最後一個例外總是被默默地忽略。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42639">bpo-42639</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 泛型現在會攤平型別參數，類似於 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Callable</span></code></a> 目前的做法。這意味著 <code class="docutils literal notranslate"><span class="pre">collections.abc.Callable[[int,</span> <span class="pre">str],</span> <span class="pre">str]</span></code> 將具有 <code class="docutils literal notranslate"><span class="pre">(int,</span> <span class="pre">str,</span> <span class="pre">str)</span></code> 的 <code class="docutils literal notranslate"><span class="pre">__args__</span></code>；以前這是 <code class="docutils literal notranslate"><span class="pre">([int,</span> <span class="pre">str],</span> <span class="pre">str)</span></code>。透過 <a class="reference internal" href="../library/typing.html#typing.get_args" title="typing.get_args"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.get_args()</span></code></a> 或 <code class="docutils literal notranslate"><span class="pre">__args__</span></code> 存取參數的程式碼需要考慮此變更。此外，對於無效形式的參數化 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a>，可能會引發 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>，而在 Python 3.9 中，該參數可能已被默默地傳遞。（由 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42195">bpo-42195</a> 中貢獻。）</p></li>
<li><p>如果給定參數不適合 16 位元無符號整數 (16-bit unsigned integer)，<a class="reference internal" href="../library/socket.html#socket.htons" title="socket.htons"><code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.htons()</span></code></a> 和 <a class="reference internal" href="../library/socket.html#socket.ntohs" title="socket.ntohs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.ntohs()</span></code></a> 現在會引發 <a class="reference internal" href="../library/exceptions.html#OverflowError" title="OverflowError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OverflowError</span></code></a> 而不是 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。（由 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42393">bpo-42393</a> 中貢獻。）</p></li>
<li><p>在 Python 3.8 中棄用後，<code class="docutils literal notranslate"><span class="pre">loop</span></code> 參數已從大多數 <a class="reference internal" href="../library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 的<a class="reference internal" href="../library/asyncio-api-index.html"><span class="doc">高階 API</span></a> 中刪除。</p>
<p>目前如下所示的協程：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
</pre></div>
</div>
<p>應替換為：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">foo()</span></code> 被專門設計為 <em>不</em> 在當前執行緒的事件循環中運行（例如在另一個執行緒的事件循環中運行），請考慮改用 <a class="reference internal" href="../library/asyncio-task.html#asyncio.run_coroutine_threadsafe" title="asyncio.run_coroutine_threadsafe"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.run_coroutine_threadsafe()</span></code></a>。</p>
<p>（由 Yurii Karabas、Andrew Svetlov、Yury Selivanov 和 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42392">bpo-42392</a> 中貢獻。）</p>
</li>
<li><p>如果 <em>globals</em> 字典沒有 <code class="docutils literal notranslate"><span class="pre">&quot;__builtins__&quot;</span></code> 鍵，則 <a class="reference internal" href="../library/types.html#types.FunctionType" title="types.FunctionType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.FunctionType</span></code></a> 建構函式現在會繼承當前的內建物件，而不是使用 <code class="docutils literal notranslate"><span class="pre">{&quot;None&quot;:</span> <span class="pre">None}</span></code>：相同行為如 <a class="reference internal" href="../library/functions.html#eval" title="eval"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#exec" title="exec"><code class="xref py py-func docutils literal notranslate"><span class="pre">exec()</span></code></a> 函式。在 Python 中使用 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function(...):</span> <span class="pre">...</span></code> 定義函式不受影響，全域變數不能用此語法覆蓋：它也繼承當前的內建物件。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42990">bpo-42990</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="changes-in-the-c-api">
<h3>C API 中的改動<a class="headerlink" href="#changes-in-the-c-api" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p>由於切換到新的 PEG 剖析器，C API 函式 <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlags</span></code>、<code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlagsFilename</span></code>、<code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseFileFlags</span></code>、<code class="docutils literal notranslate"><span class="pre">PyNode_Compile</span></code> 和被這些函式使用的型別 <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">_node</span></code> 被刪除。</p>
<p>現在應該將源程式碼直接（例如透過 <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a>）編譯為程式碼物件。然後可以（例如透過 <a class="reference internal" href="../c-api/veryhigh.html#c.PyEval_EvalCode" title="PyEval_EvalCode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_EvalCode()</span></code></a>）為產生的程式碼物件求值 (evaluated)。</p>
<p>具體來說：</p>
<ul>
<li><p>後跟有 <code class="docutils literal notranslate"><span class="pre">PyNode_Compile</span></code> 呼叫的 <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlags</span></code> 呼叫，可以替換為呼叫 <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a>。</p></li>
<li><p>沒有 <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseFileFlags</span></code> 的直接替代品。要從 <code class="docutils literal notranslate"><span class="pre">FILE</span> <span class="pre">*</span></code> 引數編譯程式碼，你需要用 C 讀取檔案並將結果緩衝區傳遞給 <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a>。</p></li>
<li><p>要編譯給定 <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*</span></code> 檔案名稱的檔案，請顯式打開該檔案，讀取它並編譯結果。一種方法是使用 <a class="reference internal" href="../library/io.html#module-io" title="io: Core tools for working with streams."><code class="xref py py-mod docutils literal notranslate"><span class="pre">io</span></code></a> 模組和 <a class="reference internal" href="../c-api/import.html#c.PyImport_ImportModule" title="PyImport_ImportModule"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_ImportModule()</span></code></a>、<a class="reference internal" href="../c-api/call.html#c.PyObject_CallMethod" title="PyObject_CallMethod"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_CallMethod()</span></code></a>、<a class="reference internal" href="../c-api/bytes.html#c.PyBytes_AsString" title="PyBytes_AsString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBytes_AsString()</span></code></a> 和 <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a>，如下所示。（宣告和錯誤處理在此被省略。）：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">io_module</span> <span class="o">=</span> <span class="n">Import_ImportModule</span><span class="p">(</span><span class="s2">&quot;io&quot;</span><span class="p">);</span>
<span class="n">fileobject</span> <span class="o">=</span> <span class="n">PyObject_CallMethod</span><span class="p">(</span><span class="n">io_module</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;ss&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">);</span>
<span class="n">source_bytes_object</span> <span class="o">=</span> <span class="n">PyObject_CallMethod</span><span class="p">(</span><span class="n">fileobject</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">PyObject_CallMethod</span><span class="p">(</span><span class="n">fileobject</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="n">source_buf</span> <span class="o">=</span> <span class="n">PyBytes_AsString</span><span class="p">(</span><span class="n">source_bytes_object</span><span class="p">);</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">Py_CompileString</span><span class="p">(</span><span class="n">source_buf</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">Py_file_input</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>對於 <code class="docutils literal notranslate"><span class="pre">FrameObject</span></code> 物件，<a class="reference internal" href="../reference/datamodel.html#frame.f_lasti" title="frame.f_lasti"><code class="xref py py-attr docutils literal notranslate"><span class="pre">f_lasti</span></code></a> 成員現在表示了字碼偏移量 (wordcode offset)，而不是位元組碼字串的簡單偏移量。這意味著這個數字需要乘以 2 才能與需要位元組偏移量的 API 一起使用（例如 <a class="reference internal" href="../c-api/code.html#c.PyCode_Addr2Line" title="PyCode_Addr2Line"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCode_Addr2Line()</span></code></a>）。還要注意，<code class="docutils literal notranslate"><span class="pre">FrameObject</span></code> 物件的 <code class="xref py py-attr docutils literal notranslate"><span class="pre">f_lasti</span></code> 成員不被認為是穩定的：請改用 <a class="reference internal" href="../c-api/frame.html#c.PyFrame_GetLineNumber" title="PyFrame_GetLineNumber"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFrame_GetLineNumber()</span></code></a>。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="cpython-bytecode-changes">
<h2>CPython 位元組碼更改<a class="headerlink" href="#cpython-bytecode-changes" title="連結到這個標頭">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MAKE_FUNCTION</span></code> 指令現在接受字典或字串元組作為函式的註釋。（由 Yurii Karabas 和 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42202">bpo-42202</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="build-changes">
<h2>建置變更<a class="headerlink" href="#build-changes" title="連結到這個標頭">¶</a></h2>
<ul>
<li><p><span class="target" id="index-114"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a>：Python 現在需要 OpenSSL 1.1.1 或更高版本。不再支援 OpenSSL 1.0.2。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43669">bpo-43669</a> 中貢獻。）</p></li>
<li><p>現在需要 C99 函式 <code class="xref c c-func docutils literal notranslate"><span class="pre">snprintf()</span></code> 和 <code class="xref c c-func docutils literal notranslate"><span class="pre">vsnprintf()</span></code> 來建置 Python。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36020">bpo-36020</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlite3</span></code></a> 需要 SQLite 3.7.15 或更新版本。（由 Sergey Fedoseev 和 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40744">bpo-40744</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40810">bpo-40810</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../library/atexit.html#module-atexit" title="atexit: Register and execute cleanup functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">atexit</span></code></a> 模組現在必須都被建置為內建模組。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42639">bpo-42639</a> 中貢獻。）</p></li>
<li><p>將 <a class="reference internal" href="../using/configure.html#cmdoption-disable-test-modules"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disable-test-modules</span></code></a> 選項新增到 <code class="docutils literal notranslate"><span class="pre">configure</span></code> 腳本中：不建置也不安裝測試模組。（由 Xavier de Gaye、Thomas Petazzoni 和 Peixing Xin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=27640">bpo-27640</a> 中貢獻。）</p></li>
<li><p>將 <a class="reference internal" href="../using/configure.html#cmdoption-with-wheel-pkg-dir"><code class="xref std std-option docutils literal notranslate"><span class="pre">--with-wheel-pkg-dir=PATH</span> <span class="pre">選項</span></code></a> 新增到 <code class="docutils literal notranslate"><span class="pre">./configure</span></code> 腳本中。如果有指定，<a class="reference internal" href="../library/ensurepip.html#module-ensurepip" title="ensurepip: Bootstrapping the &quot;pip&quot; installer into an existing Python installation or virtual environment."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ensurepip</span></code></a> 模組會在此目錄中查找 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pip</span></code> wheel 套件：如果兩者都存在，則使用這些 wheel 套件而不是 ensurepip 捆綁的 wheel 套件。</p>
<p>一些 Linux 發行版的打包策略建議不要一併包入依賴項目。例如，Fedora 在 <code class="docutils literal notranslate"><span class="pre">/usr/share/python-wheels/</span></code> 目錄中安裝 wheel 套件，並且不安裝 <code class="docutils literal notranslate"><span class="pre">ensurepip._bundled</span></code> 套件。</p>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42856">bpo-42856</a> 中貢獻。）</p>
</li>
<li><p>新增 <a class="reference internal" href="../using/configure.html#cmdoption-without-static-libpython"><code class="xref std std-option docutils literal notranslate"><span class="pre">configure</span> <span class="pre">--without-static-libpython</span> <span class="pre">選項</span></code></a> 以不建置 <code class="docutils literal notranslate"><span class="pre">libpythonMAJOR.MINOR.a</span></code> 靜態函式庫且不安裝 <code class="docutils literal notranslate"><span class="pre">python.o</span></code> 目標檔案。</p>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43103">bpo-43103</a> 中貢獻。）</p>
</li>
<li><p>如果可用，<code class="docutils literal notranslate"><span class="pre">configure</span></code> 腳本現在使用 <code class="docutils literal notranslate"><span class="pre">pkg-config</span></code> 工具程式 (utility) 來檢測 Tcl/Tk 標頭檔和函式庫的位置。和以前一樣，可以使用 <code class="docutils literal notranslate"><span class="pre">--with-tcltk-includes</span></code> 和 <code class="docutils literal notranslate"><span class="pre">--with-tcltk-libs</span></code> 配置選項顯式指定這些位置。（由 Manolis Stamatogiannakis 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42603">bpo-42603</a> 中貢獻。）</p></li>
<li><p>將 <a class="reference internal" href="../using/configure.html#cmdoption-with-openssl-rpath"><code class="xref std std-option docutils literal notranslate"><span class="pre">--with-openssl-rpath</span></code></a> 選項新增到 <code class="docutils literal notranslate"><span class="pre">configure</span></code> 腳本中。該選項簡化了使用自定義 OpenSSL 安裝建置 Python 的過程，例如 <code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">--with-openssl=/path/to/openssl</span> <span class="pre">--with-openssl-rpath=auto</span></code>。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43466">bpo-43466</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="c-api-changes">
<h2>C API 變更<a class="headerlink" href="#c-api-changes" title="連結到這個標頭">¶</a></h2>
<section id="pep-652-maintaining-the-stable-abi">
<h3>PEP 652：維護穩定 ABI<a class="headerlink" href="#pep-652-maintaining-the-stable-abi" title="連結到這個標頭">¶</a></h3>
<p>用於擴充模組或嵌入 Python 的穩定 ABI（應用程式二進位介面）現已明確定義。 <a class="reference internal" href="../c-api/stable.html#stable"><span class="std std-ref">C API 穩定性</span></a> 描述了 C API 和 ABI 穩定性保證以及使用穩定 ABI 的最佳實踐。</p>
<p>（由 Petr Viktorin 在 <span class="target" id="index-115"></span><a class="pep reference external" href="https://peps.python.org/pep-0652/"><strong>PEP 652</strong></a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43795">bpo-43795</a> 中貢獻。）</p>
</section>
<section id="id1">
<h3>新功能<a class="headerlink" href="#id1" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../c-api/number.html#c.PyNumber_Index" title="PyNumber_Index"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyNumber_Index()</span></code></a> 的結果現在都具有精確的 <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> 型別。在以前，結果可能是 <code class="docutils literal notranslate"><span class="pre">int</span></code> 子類別的實例。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40792">bpo-40792</a> 中貢獻。）</p></li>
<li><p>將新的 <a class="reference internal" href="../c-api/init_config.html#c.PyConfig.orig_argv" title="PyConfig.orig_argv"><code class="xref c c-member docutils literal notranslate"><span class="pre">orig_argv</span></code></a> 成員新增到 <a class="reference internal" href="../c-api/init_config.html#c.PyConfig" title="PyConfig"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyConfig</span></code></a> 結構：傳遞給 Python 可執行檔案的原始命令列參數列表。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=23427">bpo-23427</a> 中貢獻。）</p></li>
<li><p>新增了 <a class="reference internal" href="../c-api/datetime.html#c.PyDateTime_DATE_GET_TZINFO" title="PyDateTime_DATE_GET_TZINFO"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDateTime_DATE_GET_TZINFO()</span></code></a> 和 <a class="reference internal" href="../c-api/datetime.html#c.PyDateTime_TIME_GET_TZINFO" title="PyDateTime_TIME_GET_TZINFO"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDateTime_TIME_GET_TZINFO()</span></code></a> 巨集，用於存取 <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> 和 <a class="reference internal" href="../library/datetime.html#datetime.time" title="datetime.time"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.time</span></code></a> 物件的 <code class="docutils literal notranslate"><span class="pre">tzinfo</span></code> 屬性。（由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=30155">bpo-30155</a> 中貢獻。）</p></li>
<li><p>新增 <a class="reference internal" href="../c-api/codec.html#c.PyCodec_Unregister" title="PyCodec_Unregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCodec_Unregister()</span></code></a> 函式來取消註冊編解碼器搜索函式。（由 Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41842">bpo-41842</a> 中貢獻。）</p></li>
<li><p>新增了 <a class="reference internal" href="../c-api/iter.html#c.PyIter_Send" title="PyIter_Send"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyIter_Send()</span></code></a> 函式，以允許將值發送到疊代器中，而不會引發 <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> 例外。（由 Vladimir Matveev 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41756">bpo-41756</a> 中貢獻。）</p></li>
<li><p>將 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUTF8AndSize" title="PyUnicode_AsUTF8AndSize"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUTF8AndSize()</span></code></a> 新增到受限 C API (limited C API) 中。（由 Alex Gaynor 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41784">bpo-41784</a> 中貢獻。）</p></li>
<li><p>新增 <a class="reference internal" href="../c-api/module.html#c.PyModule_AddObjectRef" title="PyModule_AddObjectRef"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_AddObjectRef()</span></code></a> 函式：類似於 <a class="reference internal" href="../c-api/module.html#c.PyModule_AddObject" title="PyModule_AddObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_AddObject()</span></code></a> 但成功時不竊取對值的參照。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1635741">bpo-1635741</a> 中貢獻。）</p></li>
<li><p>新增 <a class="reference internal" href="../c-api/refcounting.html#c.Py_NewRef" title="Py_NewRef"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_NewRef()</span></code></a> 和 <a class="reference internal" href="../c-api/refcounting.html#c.Py_XNewRef" title="Py_XNewRef"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_XNewRef()</span></code></a> 函式來增加物件的參照計數並回傳物件。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42262">bpo-42262</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../c-api/type.html#c.PyType_FromSpecWithBases" title="PyType_FromSpecWithBases"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpecWithBases()</span></code></a> 和 <a class="reference internal" href="../c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a> 函式現在接受單個類別作為 <em>bases</em> 引數。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42423">bpo-42423</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a> 函式現在接受 NULL <code class="docutils literal notranslate"><span class="pre">tp_doc</span></code> 槽位。（由 Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41832">bpo-41832</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../c-api/type.html#c.PyType_GetSlot" title="PyType_GetSlot"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_GetSlot()</span></code></a> 函式可以接受<a class="reference internal" href="../c-api/typeobj.html#static-types"><span class="std std-ref">靜態型別 (static type)</span></a>。（由 Hai Shi 和 Petr Viktorin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41073">bpo-41073</a> 中貢獻。）</p></li>
<li><p>向 C-API 新增 <a class="reference internal" href="../c-api/set.html#c.PySet_CheckExact" title="PySet_CheckExact"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySet_CheckExact()</span></code></a> 函式，以檢查物件是否是 <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> 的實例而不是子型別的實例。（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43277">bpo-43277</a> 中貢獻。）</p></li>
<li><p>新增 <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_SetInterruptEx" title="PyErr_SetInterruptEx"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetInterruptEx()</span></code></a>，它允許傳遞信號編號來進行模擬。（由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43356">bpo-43356</a> 中貢獻。）</p></li>
<li><p>如 <a class="reference internal" href="../using/configure.html#debug-build"><span class="std std-ref">Python 是在除錯模式 (debug mode)</span></a> 下建置的（如果有定義 <code class="docutils literal notranslate"><span class="pre">Py_DEBUG</span></code> 巨集），現在會支援受限 C API。在受限 C API 中，如果 Python 是在除錯模式下建置的，並且 <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> 巨集的目標是 Python 3.10 或更新版本，<a class="reference internal" href="../c-api/refcounting.html#c.Py_INCREF" title="Py_INCREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_INCREF()</span></code></a> 和 <a class="reference internal" href="../c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> 函式現在的實作是不透明函式呼叫，而不是直接存取 <a class="reference internal" href="../c-api/typeobj.html#c.PyObject.ob_refcnt" title="PyObject.ob_refcnt"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyObject.ob_refcnt</span></code></a> 成員。在除錯模式下支援受限 C API 成為可能，因為自 Python 3.8 以來，<a class="reference internal" href="../c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a> 結構在發布和除錯模式下是相同的（請參閱:issue:<cite>36465</cite>）。</p>
<p><a class="reference internal" href="../using/configure.html#cmdoption-with-trace-refs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--with-trace-refs</span></code></a> 特殊建置（<code class="docutils literal notranslate"><span class="pre">Py_TRACE_REFS</span></code> 巨集）仍不支援受限 C API。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43688">bpo-43688</a> 中貢獻。）</p>
</li>
<li><p>新增 <a class="reference internal" href="../c-api/structures.html#c.Py_Is" title="Py_Is"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Is(x,</span> <span class="pre">y)</span></code></a> 函式來測試 <em>x</em> 物件是否為 <em>y</em> 物件，與 Python 中的 <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code> 相同。還新增 <a class="reference internal" href="../c-api/structures.html#c.Py_IsNone" title="Py_IsNone"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IsNone()</span></code></a>、<a class="reference internal" href="../c-api/structures.html#c.Py_IsTrue" title="Py_IsTrue"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IsTrue()</span></code></a>、<a class="reference internal" href="../c-api/structures.html#c.Py_IsFalse" title="Py_IsFalse"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IsFalse()</span></code></a> 函式來分別測試物件是否為 <code class="docutils literal notranslate"><span class="pre">None</span></code> 單例、 <code class="docutils literal notranslate"><span class="pre">True</span></code> 單例或 <code class="docutils literal notranslate"><span class="pre">False</span></code> 單例。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43753">bpo-43753</a> 中貢獻。）</p></li>
<li><p>新增函式以從 C 程式碼控制垃圾收集器：<a class="reference internal" href="../c-api/gcsupport.html#c.PyGC_Enable" title="PyGC_Enable"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyGC_Enable()</span></code></a>、<a class="reference internal" href="../c-api/gcsupport.html#c.PyGC_Disable" title="PyGC_Disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyGC_Disable()</span></code></a>、<a class="reference internal" href="../c-api/gcsupport.html#c.PyGC_IsEnabled" title="PyGC_IsEnabled"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyGC_IsEnabled()</span></code></a>。這些函式使得能夠從 C 程式碼啟用、停用和查詢垃圾收集器的狀態，而無需引入 <a class="reference internal" href="../library/gc.html#module-gc" title="gc: Interface to the cycle-detecting garbage collector."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gc</span></code></a> 模組。</p></li>
<li><p>新增 <a class="reference internal" href="../c-api/typeobj.html#c.Py_TPFLAGS_DISALLOW_INSTANTIATION" title="Py_TPFLAGS_DISALLOW_INSTANTIATION"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_DISALLOW_INSTANTIATION</span></code></a> 型別旗標以禁止建立型別實例。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43916">bpo-43916</a> 中貢獻。）</p></li>
<li><p>新增 <a class="reference internal" href="../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_IMMUTABLETYPE</span></code></a> 型別旗標用於建立不可變型別物件：無法設定或刪除型別屬性。（由 Victor Stinner 和 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43908">bpo-43908</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="id2">
<h3>移植到 Python 3.10<a class="headerlink" href="#id2" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p>現在必須定義 <code class="docutils literal notranslate"><span class="pre">PY_SSIZE_T_CLEAN</span></code> 巨集以使用 <a class="reference internal" href="../c-api/arg.html#c.PyArg_ParseTuple" title="PyArg_ParseTuple"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyArg_ParseTuple()</span></code></a> 和 <a class="reference internal" href="../c-api/arg.html#c.Py_BuildValue" title="Py_BuildValue"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_BuildValue()</span></code></a> 格式，這些格式使用 <code class="docutils literal notranslate"><span class="pre">#</span></code>: <code class="docutils literal notranslate"><span class="pre">es#</span></code>, <code class="docutils literal notranslate"><span class="pre">et#</span></code>、<code class="docutils literal notranslate"><span class="pre">s#</span></code>、<code class="docutils literal notranslate"><span class="pre">u#</span></code>、<code class="docutils literal notranslate"><span class="pre">y#</span></code>、<code class="docutils literal notranslate"><span class="pre">z#</span></code>、<code class="docutils literal notranslate"><span class="pre">U#</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Z#</span></code>。請參閱 <a class="reference internal" href="../c-api/arg.html#arg-parsing"><span class="std std-ref">剖析引數與建置數值</span></a> 和 <span class="target" id="index-116"></span><a class="pep reference external" href="https://peps.python.org/pep-0353/"><strong>PEP 353</strong></a>。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40943">bpo-40943</a> 中貢獻。）</p></li>
<li><p>由於 <a class="reference internal" href="../c-api/refcounting.html#c.Py_REFCNT" title="Py_REFCNT"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_REFCNT()</span></code></a> 更改為行內靜態函式 (inline static function)，因此 <code class="docutils literal notranslate"><span class="pre">Py_REFCNT(obj)</span> <span class="pre">=</span> <span class="pre">new_refcnt</span></code> 必須替換為 <code class="docutils literal notranslate"><span class="pre">Py_SET_REFCNT(obj,</span> <span class="pre">new_refcnt)</span></code> ：參見 <a class="reference internal" href="../c-api/refcounting.html#c.Py_SET_REFCNT" title="Py_SET_REFCNT"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SET_REFCNT()</span></code></a> （自 Python 3.9 起可用）。為了向後相容，可以使用該巨集：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#if PY_VERSION_HEX &lt; 0x030900A4</span>
<span class="c1">#  define Py_SET_REFCNT(obj, refcnt) ((Py_REFCNT(obj) = (refcnt)), (void)0)</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39573">bpo-39573</a> 中貢獻。）</p>
</li>
<li><p>由於過去的種種原因，過去在不持有 <a class="reference internal" href="../glossary.html#term-GIL"><span class="xref std std-term">GIL</span></a> 的情況下呼叫 <a class="reference internal" href="../c-api/dict.html#c.PyDict_GetItem" title="PyDict_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDict_GetItem()</span></code></a> 是被允許的。目前已被禁止。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40839">bpo-40839</a> 中貢獻。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnicode_FromUnicode(NULL,</span> <span class="pre">size)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyUnicode_FromStringAndSize(NULL,</span> <span class="pre">size)</span></code> 現在會引發 <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code>。請改用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_New" title="PyUnicode_New"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_New()</span></code></a> 來分配沒有初始資料的 Unicode 物件。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36346">bpo-36346</a> 中貢獻。）</p></li>
<li><p>PyCapsule API <code class="docutils literal notranslate"><span class="pre">unicodedata.ucnhash_CAPI</span></code> 的私有 <code class="docutils literal notranslate"><span class="pre">_PyUnicode_Name_CAPI</span></code> 結構已移至內部 C API。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42157">bpo-42157</a> 中貢獻。）</p></li>
<li><p>如果在 <a class="reference internal" href="../c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a> 之前（Python 初始化之前）被呼叫，<a class="reference internal" href="../c-api/init.html#c.Py_GetPath" title="Py_GetPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPath()</span></code></a>、<a class="reference internal" href="../c-api/init.html#c.Py_GetPrefix" title="Py_GetPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPrefix()</span></code></a>、<a class="reference internal" href="../c-api/init.html#c.Py_GetExecPrefix" title="Py_GetExecPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetExecPrefix()</span></code></a>、<a class="reference internal" href="../c-api/init.html#c.Py_GetProgramFullPath" title="Py_GetProgramFullPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetProgramFullPath()</span></code></a>、<a class="reference internal" href="../c-api/init.html#c.Py_GetPythonHome" title="Py_GetPythonHome"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPythonHome()</span></code></a> 和 <a class="reference internal" href="../c-api/init.html#c.Py_GetProgramName" title="Py_GetProgramName"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetProgramName()</span></code></a> 現在會回傳 <code class="docutils literal notranslate"><span class="pre">NULL</span></code>。使用新的 <a class="reference internal" href="../c-api/init_config.html#init-config"><span class="std std-ref">Python 初始化設定</span></a> API 來獲取 <a class="reference internal" href="../c-api/init_config.html#init-path-config"><span class="std std-ref">Python Path Configuration</span></a>。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42260">bpo-42260</a> 中貢獻。）</p></li>
<li><p><a class="reference internal" href="../c-api/list.html#c.PyList_SET_ITEM" title="PyList_SET_ITEM"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyList_SET_ITEM()</span></code></a>、<a class="reference internal" href="../c-api/tuple.html#c.PyTuple_SET_ITEM" title="PyTuple_SET_ITEM"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyTuple_SET_ITEM()</span></code></a> 和 <a class="reference internal" href="../c-api/cell.html#c.PyCell_SET" title="PyCell_SET"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCell_SET()</span></code></a> 巨集不能再用作左值 (l-value) 或右值 (r-value)。例如，<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">PyList_SET_ITEM(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyList_SET_ITEM(a,</span> <span class="pre">b,</span> <span class="pre">c)</span> <span class="pre">=</span> <span class="pre">x</span></code> 現在會失敗並出現編譯器錯誤。它可以防止如 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(PyList_SET_ITEM</span> <span class="pre">(a,</span> <span class="pre">b,</span> <span class="pre">c)</span> <span class="pre">&lt;</span> <span class="pre">0)</span> <span class="pre">...</span></code> 測試之類的錯誤。（由 Zackery Spytz 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=30459">bpo-30459</a> 中貢獻。）</p></li>
<li><p>非受限 API 檔案 <code class="docutils literal notranslate"><span class="pre">odictobject.h</span></code>、<code class="docutils literal notranslate"><span class="pre">parser_interface.h</span></code>、<code class="docutils literal notranslate"><span class="pre">picklebufobject.h</span></code>、<code class="docutils literal notranslate"><span class="pre">pyarena.h</span></code>、<code class="docutils literal notranslate"><span class="pre">pyctype.h</span></code>、<code class="docutils literal notranslate"><span class="pre">pydebug.h</span></code>、<code class="docutils literal notranslate"><span class="pre">pyfpe.h</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pytime.h</span></code> 已移至 <code class="docutils literal notranslate"><span class="pre">Include/cpython</span></code> 目錄。這些檔案不得直接被引入，因為它們已於 <code class="docutils literal notranslate"><span class="pre">Python.h</span></code> 中引入；請參閱 <a class="reference internal" href="../c-api/intro.html#api-includes"><span class="std std-ref">引入檔案 (include files)</span></a>。如果直接引入它們，請考慮改為引入 <code class="docutils literal notranslate"><span class="pre">Python.h</span></code>。（由 Nicholas Sim 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35134">bpo-35134</a> 中貢獻。）</p></li>
<li><p>使用 <a class="reference internal" href="../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_IMMUTABLETYPE</span></code></a> 型別旗標來建立不可變型別物件。不要依賴 <a class="reference internal" href="../c-api/typeobj.html#c.Py_TPFLAGS_HEAPTYPE" title="Py_TPFLAGS_HEAPTYPE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_HEAPTYPE</span></code></a> 來決定型別物件是否可變；應改為檢查是否設定了 <a class="reference internal" href="../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_TPFLAGS_IMMUTABLETYPE</span></code></a>。（由 Victor Stinner 和 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35134">bpo-35134</a> 中貢獻。）</p></li>
<li><p>未以說明文件記錄的函式 <code class="docutils literal notranslate"><span class="pre">Py_FrozenMain</span></code> 已從受限 API 中刪除。該函式主要用於 Python 的自定義建置。（由 Petr Viktorin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26241">bpo-26241</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="id3">
<h3>已棄用<a class="headerlink" href="#id3" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnicode_InternImmortal()</span></code> 函式現已棄用，並將在 Python 3.12 中刪除：請改用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_InternInPlace" title="PyUnicode_InternInPlace"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_InternInPlace()</span></code></a>。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41692">bpo-41692</a> 中貢獻。）</p></li>
</ul>
</section>
<section id="id4">
<h3>已刪除<a class="headerlink" href="#id4" title="連結到這個標頭">¶</a></h3>
<ul>
<li><p>刪除了操作 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE*</span></code> 字串的 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE_str*</span></code> 函式。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41123">bpo-41123</a> 中貢獻。）</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strlen</span></code>：使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GetLength" title="PyUnicode_GetLength"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetLength()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GET_LENGTH" title="PyUnicode_GET_LENGTH"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_GET_LENGTH</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strcat</span></code>：使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CopyCharacters" title="PyUnicode_CopyCharacters"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CopyCharacters()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormat()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strcpy</span></code>、<code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strncpy</span></code>：使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CopyCharacters" title="PyUnicode_CopyCharacters"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CopyCharacters()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Substring" title="PyUnicode_Substring"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Substring()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strcmp</span></code>：使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Compare" title="PyUnicode_Compare"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Compare()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strncmp</span></code>：使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Tailmatch" title="PyUnicode_Tailmatch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Tailmatch()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strchr</span></code>、<code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strrchr</span></code>：使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FindChar" title="PyUnicode_FindChar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FindChar()</span></code></a></p></li>
</ul>
</li>
<li><p>刪除了 <code class="docutils literal notranslate"><span class="pre">PyUnicode_GetMax()</span></code>。請改用新的 (<span class="target" id="index-117"></span><a class="pep reference external" href="https://peps.python.org/pep-0393/"><strong>PEP 393</strong></a>) API。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41103">bpo-41103</a> 中貢獻。）</p></li>
<li><p>刪除了 <code class="docutils literal notranslate"><span class="pre">PyLong_FromUnicode()</span></code>。請改用 <a class="reference internal" href="../c-api/long.html#c.PyLong_FromUnicodeObject" title="PyLong_FromUnicodeObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_FromUnicodeObject()</span></code></a>。（由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41103">bpo-41103</a> 中貢獻。）</p></li>
<li><p>刪除了 <code class="docutils literal notranslate"><span class="pre">PyUnicode_AsUnicodeCopy()</span></code>。請改用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUCS4Copy" title="PyUnicode_AsUCS4Copy"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUCS4Copy()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsWideCharString" title="PyUnicode_AsWideCharString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsWideCharString()</span></code></a> （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41103">bpo-41103</a> 中貢獻。）</p></li>
<li><p>刪除了 <code class="docutils literal notranslate"><span class="pre">_Py_CheckRecursionLimit</span></code> 變數：它已被 <a class="reference internal" href="../c-api/init.html#c.PyInterpreterState" title="PyInterpreterState"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyInterpreterState</span></code></a> 結構的 <code class="docutils literal notranslate"><span class="pre">ceval.recursion_limit</span></code> 取代。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41834">bpo-41834</a> 中貢獻。）</p></li>
<li><p>刪除了未被說明文件記錄的巨集 <code class="docutils literal notranslate"><span class="pre">Py_ALLOW_RECURSION</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Py_END_ALLOW_RECURSION</span></code> 以及 <a class="reference internal" href="../c-api/init.html#c.PyInterpreterState" title="PyInterpreterState"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyInterpreterState</span></code></a> 結構的 <code class="docutils literal notranslate"><span class="pre">recursion_ritic</span></code> 欄位。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41936">bpo-41936</a> 中貢獻。）</p></li>
<li><p>刪除了未被說明文件記錄的 <code class="docutils literal notranslate"><span class="pre">PyOS_InitInterrupts()</span></code> 函式。初始化 Python 已經隱式安裝信號處理程式：請參閱 <a class="reference internal" href="../c-api/init_config.html#c.PyConfig.install_signal_handlers" title="PyConfig.install_signal_handlers"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.install_signal_handlers</span></code></a>。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41713">bpo-41713</a> 中貢獻。）</p></li>
<li><p>刪除 <code class="docutils literal notranslate"><span class="pre">PyAST_Validate()</span></code> 函式。不再可能使用公開 C API 來建置 AST 物件（<code class="docutils literal notranslate"><span class="pre">mod_ty</span></code> 類型）。該函式已被排除在受限 C API 之外 (<span class="target" id="index-118"></span><a class="pep reference external" href="https://peps.python.org/pep-0384/"><strong>PEP 384</strong></a>)。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> 中貢獻。）</p></li>
<li><p>刪除 <code class="docutils literal notranslate"><span class="pre">symtable.h</span></code> 標頭檔和未被說明文件記錄的函式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyST_GetScope()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PySymtable_Build()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PySymtable_BuildObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PySymtable_Free()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_SymtableString()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_SymtableStringObject()</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Py_SymtableString()</span></code> 函式錯誤地成為穩定 ABI 的一部分，但它因為 <code class="docutils literal notranslate"><span class="pre">symtable.h</span></code> 標頭檔被排除在受限 C API 之外而無法使用。</p>
<p>請改用 Python <a class="reference internal" href="../library/symtable.html#module-symtable" title="symtable: Interface to the compiler's internal symbol tables."><code class="xref py py-mod docutils literal notranslate"><span class="pre">symtable</span></code></a> 模組。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> 中貢獻。）</p>
</li>
<li><p>從受限 C API 標頭和 <code class="docutils literal notranslate"><span class="pre">python3.dll</span></code> （在 Windows 上提供穩定 ABI 的函式庫）中刪除 <a class="reference internal" href="../c-api/veryhigh.html#c.PyOS_ReadlineFunctionPointer" title="PyOS_ReadlineFunctionPointer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyOS_ReadlineFunctionPointer()</span></code></a>。由於該函式採用 FILE* 引數，因此無法保證其 ABI 穩定性。（由 Petr Viktorin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43868">bpo-43868</a> 中貢獻。）</p></li>
<li><p>刪除 <code class="docutils literal notranslate"><span class="pre">ast.h</span></code>、<code class="docutils literal notranslate"><span class="pre">asdl.h</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Python-ast.h</span></code> 標頭檔。這些函式沒有文件記錄，並且被排除在受限 C API 之外。這些標頭檔定義的大多數名稱都沒有前綴 <code class="docutils literal notranslate"><span class="pre">Py</span></code>，因此可能會產生名稱衝突。例如，<code class="docutils literal notranslate"><span class="pre">Python-ast.h</span></code> 定義了一個 <code class="docutils literal notranslate"><span class="pre">Yield</span></code> 巨集，它與 Windows <code class="docutils literal notranslate"><span class="pre">&lt;winbase.h&gt;</span></code> 標頭使用的 <code class="docutils literal notranslate"><span class="pre">Yield</span></code> 有名稱衝突。請改用 Python <a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 模組。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> 中貢獻。）</p></li>
<li><p>刪除編譯器和使用 <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">_mod</span></code> 的剖析器函式，因為公開 AST C API 已被刪除：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyAST_Compile()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyAST_CompileEx()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyAST_CompileObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyFuture_FromAST()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyFuture_FromASTObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromFile()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromFileObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromFilename()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromString()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromStringObject()</span></code></p></li>
</ul>
<p>這些函式沒有文件記錄，並且被排除在受限 C API 之外。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> 中貢獻。）</p>
</li>
<li><p>刪除包含以下函式的 <code class="docutils literal notranslate"><span class="pre">pyarena.h</span></code> 標頭檔：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_New()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_Free()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_Malloc()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_AddPyObject()</span></code></p></li>
</ul>
<p>這些函式沒有文件記錄、被排除在受限 C API 之外，並僅被編譯器於內部使用。（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> 中貢獻。）</p>
</li>
<li><p>為了 Python 最佳化，已刪除 <code class="docutils literal notranslate"><span class="pre">PyThreadState.use_tracing</span></code> 成員。（由 Mark Shannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43760">bpo-43760</a> 中貢獻。）</p></li>
</ul>
</section>
</section>
<section id="notable-security-feature-in-3-10-7">
<h2>Notable security feature in 3.10.7<a class="headerlink" href="#notable-security-feature-in-3-10-7" title="連結到這個標頭">¶</a></h2>
<p>Converting between <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> and <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> in bases other than 2
(binary), 4, 8 (octal), 16 (hexadecimal), or 32 such as base 10 (decimal)
now raises a <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> if the number of digits in string form is
above a limit to avoid potential denial of service attacks due to the
algorithmic complexity. This is a mitigation for <a class="extlink-cve reference external" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-10735">CVE-2020-10735</a>.
This limit can be configured or disabled by environment variable, command
line flag, or <a class="reference internal" href="../library/sys.html#module-sys" title="sys: Access system-specific parameters and functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys</span></code></a> APIs. See the <a class="reference internal" href="../library/stdtypes.html#int-max-str-digits"><span class="std std-ref">integer string conversion
length limitation</span></a> documentation.  The default limit
is 4300 digits in string form.</p>
</section>
<section id="notable-security-feature-in-3-10-8">
<h2>Notable security feature in 3.10.8<a class="headerlink" href="#notable-security-feature-in-3-10-8" title="連結到這個標頭">¶</a></h2>
<p>The deprecated <code class="xref py py-mod docutils literal notranslate"><span class="pre">mailcap</span></code> module now refuses to inject unsafe text
(filenames, MIME types, parameters) into shell commands. Instead of using such
text, it will warn and act as if a match was not found (or for test commands,
as if the test failed).
(Contributed by Petr Viktorin in <a class="reference external" href="https://github.com/python/cpython/issues/98966">gh-98966</a>.)</p>
</section>
<section id="notable-changes-in-3-10-12">
<h2>Notable changes in 3.10.12<a class="headerlink" href="#notable-changes-in-3-10-12" title="連結到這個標頭">¶</a></h2>
<section id="tarfile">
<h3>tarfile<a class="headerlink" href="#tarfile" title="連結到這個標頭">¶</a></h3>
<ul class="simple">
<li><p>The extraction methods in <a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a>, and <a class="reference internal" href="../library/shutil.html#shutil.unpack_archive" title="shutil.unpack_archive"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.unpack_archive()</span></code></a>,
have a new a <em>filter</em> argument that allows limiting tar features than may be
surprising or dangerous, such as creating files outside the destination
directory.
See <a class="reference internal" href="../library/tarfile.html#tarfile-extraction-filter"><span class="std std-ref">Extraction filters</span></a> for details.
In Python 3.12, use without the <em>filter</em> argument will show a
<a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>.
In Python 3.14, the default will switch to <code class="docutils literal notranslate"><span class="pre">'data'</span></code>.
(Contributed by Petr Viktorin in <span class="target" id="index-40"></span><a class="pep reference external" href="https://peps.python.org/pep-0706/"><strong>PEP 706</strong></a>.)</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目錄</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.10 有什麼新功能</a><ul>
<li><a class="reference internal" href="#summary-release-highlights">摘要 -- 發布重點</a></li>
<li><a class="reference internal" href="#new-features">新功能</a><ul>
<li><a class="reference internal" href="#parenthesized-context-managers">帶括號的情境管理器</a></li>
<li><a class="reference internal" href="#better-error-messages">更好的錯誤訊息</a><ul>
<li><a class="reference internal" href="#syntaxerrors">SyntaxErrors</a></li>
<li><a class="reference internal" href="#indentationerrors">IndentationErrors</a></li>
<li><a class="reference internal" href="#attributeerrors">AttributeErrors</a></li>
<li><a class="reference internal" href="#nameerrors">NameErrors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pep-626-precise-line-numbers-for-debugging-and-other-tools">PEP 626：用於除錯和其他工具的精確列號</a></li>
<li><a class="reference internal" href="#pep-634-structural-pattern-matching">PEP 634：結構模式匹配</a><ul>
<li><a class="reference internal" href="#syntax-and-operations">語法和操作</a></li>
<li><a class="reference internal" href="#declarative-approach">宣告式方法 (Declarative approach)</a></li>
<li><a class="reference internal" href="#simple-pattern-match-to-a-literal">簡單模式：與字面值匹配</a><ul>
<li><a class="reference internal" href="#behavior-without-the-wildcard">沒有萬用字元 (wildcard) 的行為</a></li>
</ul>
</li>
<li><a class="reference internal" href="#patterns-with-a-literal-and-variable">具有字面值和變數的模式</a></li>
<li><a class="reference internal" href="#patterns-and-classes">模式和類別</a><ul>
<li><a class="reference internal" href="#patterns-with-positional-parameters">具有位置參數的模式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nested-patterns">巢狀模式</a></li>
<li><a class="reference internal" href="#complex-patterns-and-the-wildcard">複雜模式和萬用字元</a></li>
<li><a class="reference internal" href="#guard">Guard</a></li>
<li><a class="reference internal" href="#other-key-features">其他主要功能</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-encodingwarning-and-encoding-locale-option">可選的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code> 和 <code class="docutils literal notranslate"><span class="pre">encoding=&quot;locale&quot;</span></code> 選項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-features-related-to-type-hints">與型別提示相關的新功能</a><ul>
<li><a class="reference internal" href="#pep-604-new-type-union-operator">PEP 604：新型聯集運算子</a></li>
<li><a class="reference internal" href="#pep-612-parameter-specification-variables">PEP 612：參數規範變數</a></li>
<li><a class="reference internal" href="#pep-613-typealias">PEP 613：型別別名 (TypeAlias)</a></li>
<li><a class="reference internal" href="#pep-647-user-defined-type-guards">PEP 647：使用者定義的型別防護</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-language-changes">其他語言更動</a></li>
<li><a class="reference internal" href="#new-modules">新模組</a></li>
<li><a class="reference internal" href="#improved-modules">改進的模組</a><ul>
<li><a class="reference internal" href="#asyncio">asyncio</a></li>
<li><a class="reference internal" href="#argparse">argparse</a></li>
<li><a class="reference internal" href="#array">array</a></li>
<li><a class="reference internal" href="#asynchat-asyncore-smtpd">asynchat, asyncore, smtpd</a></li>
<li><a class="reference internal" href="#base64">base64</a></li>
<li><a class="reference internal" href="#bdb">bdb</a></li>
<li><a class="reference internal" href="#bisect">bisect</a></li>
<li><a class="reference internal" href="#codecs">codecs</a></li>
<li><a class="reference internal" href="#collections-abc">collections.abc</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#curses">curses</a></li>
<li><a class="reference internal" href="#dataclasses">dataclasses</a><ul>
<li><a class="reference internal" href="#slots">__slots__</a></li>
<li><a class="reference internal" href="#keyword-only-fields">僅限關鍵字欄位 (Keyword-only fields)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#distutils">distutils</a></li>
<li><a class="reference internal" href="#doctest">doctest</a></li>
<li><a class="reference internal" href="#encodings">encodings</a></li>
<li><a class="reference internal" href="#enum">enum</a></li>
<li><a class="reference internal" href="#fileinput">fileinput</a></li>
<li><a class="reference internal" href="#faulthandler">faulthandler</a></li>
<li><a class="reference internal" href="#gc">gc</a></li>
<li><a class="reference internal" href="#glob">glob</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#hmac">hmac</a></li>
<li><a class="reference internal" href="#idle-and-idlelib">IDLE 和 idlelib</a></li>
<li><a class="reference internal" href="#importlib-metadata">importlib.metadata</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#linecache">linecache</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#os-path">os.path</a></li>
<li><a class="reference internal" href="#pathlib">pathlib</a></li>
<li><a class="reference internal" href="#platform">platform</a></li>
<li><a class="reference internal" href="#pprint">pprint</a></li>
<li><a class="reference internal" href="#py-compile">py_compile</a></li>
<li><a class="reference internal" href="#pyclbr">pyclbr</a></li>
<li><a class="reference internal" href="#shelve">shelve</a></li>
<li><a class="reference internal" href="#statistics">statistics</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#sys">sys</a></li>
<li><a class="reference internal" href="#thread">_thread</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#traceback">traceback</a></li>
<li><a class="reference internal" href="#types">types</a></li>
<li><a class="reference internal" href="#typing">typing</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#xml">xml</a></li>
<li><a class="reference internal" href="#zipimport">zipimport</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimizations">最佳化</a></li>
<li><a class="reference internal" href="#deprecated">已棄用</a></li>
<li><a class="reference internal" href="#removed">已刪除</a></li>
<li><a class="reference internal" href="#porting-to-python-3-10">移植到 Python 3.10</a><ul>
<li><a class="reference internal" href="#changes-in-the-python-syntax">Python 語法的變化</a></li>
<li><a class="reference internal" href="#changes-in-the-python-api">Python API 的變化</a></li>
<li><a class="reference internal" href="#changes-in-the-c-api">C API 中的改動</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cpython-bytecode-changes">CPython 位元組碼更改</a></li>
<li><a class="reference internal" href="#build-changes">建置變更</a></li>
<li><a class="reference internal" href="#c-api-changes">C API 變更</a><ul>
<li><a class="reference internal" href="#pep-652-maintaining-the-stable-abi">PEP 652：維護穩定 ABI</a></li>
<li><a class="reference internal" href="#id1">新功能</a></li>
<li><a class="reference internal" href="#id2">移植到 Python 3.10</a></li>
<li><a class="reference internal" href="#id3">已棄用</a></li>
<li><a class="reference internal" href="#id4">已刪除</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notable-security-feature-in-3-10-7">Notable security feature in 3.10.7</a></li>
<li><a class="reference internal" href="#notable-security-feature-in-3-10-8">Notable security feature in 3.10.8</a></li>
<li><a class="reference internal" href="#notable-changes-in-3-10-12">Notable changes in 3.10.12</a><ul>
<li><a class="reference internal" href="#tarfile">tarfile</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上個主題</h4>
    <p class="topless"><a href="3.11.html"
                          title="上一章">Python 3.11 有什麼新功能</a></p>
  </div>
  <div>
    <h4>下個主題</h4>
    <p class="topless"><a href="3.9.html"
                          title="下一章">Python 3.9 有什麼新功能</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>此頁面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">回報錯誤</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.10.rst"
            rel="nofollow">顯示原始碼
        </a>
      </li>
    </ul>
  </div>
        </div>
<div id="sidebarbutton" title="收合側邊欄">
<span>«</span>
</div>

      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="Related">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="總索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模組索引"
             >模組</a> |</li>
        <li class="right" >
          <a href="3.9.html" title="Python 3.9 有什麼新功能"
             >下一頁</a> |</li>
        <li class="right" >
          <a href="3.11.html" title="Python 3.11 有什麼新功能"
             >上一頁</a> |</li>

          <li><img src="../_static/py.svg" alt="Python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.12.4 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 有什麼新功能？</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.10 有什麼新功能</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜尋" aria-label="快速搜尋" type="search" name="q" id="search-box" />
          <input type="submit" value="前往" />
        </form>
    </div>
                     |
                </li>
            <li class="right">
<label class="theme-selector-label">
    Theme
    <select class="theme-selector" oninput="activateTheme(this.value)">
        <option value="auto" selected>Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
    </select>
</label> |</li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; 
      <a href="../copyright.html">
    
    版權
    
      </a>
     2001-2024, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    
      See <a href="/license.html">History and License</a> for more information.<br />
    
    
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />
      最後更新於 Jul 20, 2024 (06:27 UTC)。
    
      <a href="/bugs.html">Found a bug</a>?
    
    <br />

    使用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.6 建立。
    </div>

  </body>
</html>